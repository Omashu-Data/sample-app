<!-- Tab de Resumen - Dise帽o Mejorado con Sistema de Tarjetas -->
<div class="overview-tab-content layout-column" style="background: var(--background-primary, #090521); color: var(--text-primary, #fff); padding: var(--spacing-md) var(--spacing-lg); gap: var(--spacing-md);">

  <!-- Secci贸n Superior: Info Jugador + KDA (Ultra compacto) -->
  <div class="card" style="padding: var(--spacing-sm) var(--spacing-md); background: linear-gradient(to right, rgba(19, 11, 55, 0.95), rgba(39, 22, 100, 0.85)); border: 1px solid rgba(109, 61, 255, 0.2); border-radius: var(--border-radius-md); box-shadow: var(--shadow-md);">
    <div class="flex-row align-center justify-between" style="gap: var(--spacing-md);">
      <!-- Info Jugador -->
      <div class="player-info flex-row align-center" style="gap: var(--spacing-sm);">
        <div class="avatar-placeholder border-radius-round" style="width: 32px; height: 32px; background: linear-gradient(135deg, var(--omashu-purple-dark), #1e104d); border: 1px solid var(--omashu-active, #7747ea); box-shadow: 0 0 10px rgba(109, 61, 255, 0.3); display: flex; align-items: center; justify-content: center;">
          <div style="font-size: 16px; color: var(--omashu-purple-light);"></div>
        </div>
        <div class="player-details">
          <div id="player-name" class="font-md font-bold" style="color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.5); line-height: var(--line-height-tight);">Cargando...</div>
          <div id="player-role" class="text-secondary font-sm" style="color: var(--text-secondary, rgba(255,255,255,0.65)); line-height: var(--line-height-tight);">Rol Principal</div>
        </div>
      </div>

      <!-- Tiempo de juego + EN VIVO -->
      <div class="flex-row align-center" style="gap: var(--spacing-sm);">
        <div class="time-stat text-center">
          <div id="game-time-value" class="font-md font-bold" style="color: var(--omashu-active, #7747ea); text-shadow: 0 0 5px rgba(119, 71, 234, 0.5); line-height: var(--line-height-tight);">00:00</div>
        </div>
        <div style="font-size: var(--font-size-xs); padding: 2px 8px; background: linear-gradient(to right, #6d3dff, #7747ea); border-radius: var(--border-radius-round); animation: pulse 2s infinite; line-height: var(--line-height-tight); box-shadow: 0 0 12px rgba(109, 61, 255, 0.5);">EN VIVO</div>
      </div>

      <!-- Stats KDA Compacto y Mejorado -->
      <div class="kda-stat flex-row align-center" style="background: rgba(13, 7, 35, 0.6); padding: 5px 12px; border-radius: var(--border-radius-md); min-width: 95px; justify-content: center; border: 1px solid rgba(109, 61, 255, 0.1); box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);">
        <div id="kda-kills" class="font-md font-bold" style="color: var(--positive-color, #4caf50); text-shadow: 0 0 5px rgba(76, 175, 80, 0.5);">0</div>
        <span style="color: var(--text-secondary); font-size: var(--font-size-md); margin: 0 5px; opacity: 0.6;">/</span>
        <div id="kda-deaths" class="font-md font-bold" style="color: var(--negative-color, #f44336); text-shadow: 0 0 5px rgba(244, 67, 54, 0.5);">0</div>
        <span style="color: var(--text-secondary); font-size: var(--font-size-md); margin: 0 5px; opacity: 0.6;">/</span>
        <div id="kda-assists" class="font-md font-bold" style="color: var(--info-color, #29b6f6); text-shadow: 0 0 5px rgba(41, 182, 246, 0.5);">0</div>
      </div>
    </div>
  </div>

  <!-- Espacio entre secciones principales -->
  <div style="height: var(--spacing-xs);"></div>

  <!-- Secci贸n de Retos -->
  <div class="challenges-section layout-column flex-grow" style="gap: var(--spacing-md);">
    <div class="flex-row align-center justify-between" style="margin-bottom: var(--spacing-xs);">
      <h3 class="title-section font-md font-bold" style="color: var(--omashu-purple-light, #bc76ff); text-shadow: var(--text-shadow-subtle); margin: 0; text-transform: uppercase; letter-spacing: 0.5px;">Retos de la Partida</h3>
      <div style="height: 2px; flex-grow: 1; margin-left: var(--spacing-md); background: linear-gradient(90deg, var(--omashu-purple, #6d3dff) 0%, rgba(109, 61, 255, 0) 100%);"></div>
    </div>
    
    <!-- Contenedor de retos con grid mejorada -->
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-md);">
      <!-- Reto 1: Wards -->
      <div class="challenge-item" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; border-left: 3px solid var(--omashu-purple, #6d3dff); box-shadow: var(--shadow-md); height: 120px; display: flex; flex-direction: column; transition: transform 0.2s ease, box-shadow 0.2s ease;">
        <div style="display: flex; align-items: center; padding: var(--spacing-xs) var(--spacing-sm); border-bottom: 1px solid rgba(109, 61, 255, 0.15); height: 36px; background: rgba(109, 61, 255, 0.1);">
          <div style="width: 20px; height: 20px; border-radius: 50%; background-color: rgba(109, 61, 255, 0.2); display: flex; align-items: center; justify-content: center; margin-right: var(--spacing-xs); box-shadow: 0 0 5px rgba(109, 61, 255, 0.3);">
            <img src="../../img/ward-icon.svg" alt="Wards" style="width: 12px; height: 12px; filter: drop-shadow(0 0 2px rgba(109, 61, 255, 0.5));"/>
          </div>
          <div style="font-size: var(--font-size-xs); font-weight: var(--font-weight-medium); color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.5px;">Coloca 5 Wards</div>
        </div>
        <div style="padding: var(--spacing-sm); position: relative; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; background: linear-gradient(180deg, rgba(19, 11, 55, 0.3), rgba(19, 11, 55, 0.5));">
          <div style="display: flex; justify-content: center; align-items: center; margin-bottom: var(--spacing-sm);">
            <div id="challenge-wards-value" style="font-size: var(--font-size-xl); font-weight: var(--font-weight-bold); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 8px rgba(188, 118, 255, 0.5);">0/5</div>
          </div>
          <div style="height: 6px; background-color: rgba(109, 61, 255, 0.1); border-radius: var(--border-radius-sm); overflow: hidden; box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);">
            <div id="challenge-wards-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, var(--omashu-purple, #6d3dff), var(--omashu-purple-light, #bc76ff)); border-radius: var(--border-radius-sm); transition: width 0.5s ease-out; box-shadow: 0 0 5px rgba(109, 61, 255, 0.5);"></div>
          </div>
        </div>
      </div>

      <!-- Reto 2: Kills -->
      <div class="challenge-item" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; border-left: 3px solid var(--negative-color, #f44336); box-shadow: var(--shadow-md); height: 120px; display: flex; flex-direction: column; transition: transform 0.2s ease, box-shadow 0.2s ease;">
        <div style="display: flex; align-items: center; padding: var(--spacing-xs) var(--spacing-sm); border-bottom: 1px solid rgba(244, 67, 54, 0.15); height: 36px; background: rgba(244, 67, 54, 0.1);">
          <div style="width: 20px; height: 20px; border-radius: 50%; background-color: rgba(244, 67, 54, 0.2); display: flex; align-items: center; justify-content: center; margin-right: var(--spacing-xs); box-shadow: 0 0 5px rgba(244, 67, 54, 0.3);">
            <img src="../../img/sword-icon.svg" alt="Kills" style="width: 12px; height: 12px; filter: drop-shadow(0 0 2px rgba(244, 67, 54, 0.5));"/>
          </div>
          <div style="font-size: var(--font-size-xs); font-weight: var(--font-weight-medium); color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.5px;">Consigue 3 Kills</div>
        </div>
        <div style="padding: var(--spacing-sm); position: relative; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; background: linear-gradient(180deg, rgba(19, 11, 55, 0.3), rgba(19, 11, 55, 0.5));">
          <div style="display: flex; justify-content: center; align-items: center; margin-bottom: var(--spacing-sm);">
            <div id="challenge-kills-value" style="font-size: var(--font-size-xl); font-weight: var(--font-weight-bold); color: var(--negative-color, #f44336); text-shadow: 0 0 8px rgba(244, 67, 54, 0.5);">0/3</div>
          </div>
          <div style="height: 6px; background-color: rgba(244, 67, 54, 0.1); border-radius: var(--border-radius-sm); overflow: hidden; box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);">
            <div id="challenge-kills-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #f44336, #ff7961); border-radius: var(--border-radius-sm); transition: width 0.5s ease-out; box-shadow: 0 0 5px rgba(244, 67, 54, 0.5);"></div>
          </div>
        </div>
      </div>

      <!-- Reto 3: CS/min -->
      <div class="challenge-item" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; border-left: 3px solid var(--positive-color, #4caf50); box-shadow: var(--shadow-md); height: 120px; display: flex; flex-direction: column; transition: transform 0.2s ease, box-shadow 0.2s ease;">
        <div style="display: flex; align-items: center; padding: var(--spacing-xs) var(--spacing-sm); border-bottom: 1px solid rgba(76, 175, 80, 0.15); height: 36px; background: rgba(76, 175, 80, 0.1);">
          <div style="width: 20px; height: 20px; border-radius: 50%; background-color: rgba(76, 175, 80, 0.2); display: flex; align-items: center; justify-content: center; margin-right: var(--spacing-xs); box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);">
            <img src="../../img/cs-icon.svg" alt="CS" style="width: 12px; height: 12px; filter: drop-shadow(0 0 2px rgba(76, 175, 80, 0.5));"/>
          </div>
          <div style="font-size: var(--font-size-xs); font-weight: var(--font-weight-medium); color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.5px;">Obt茅n 8 CS/min</div>
        </div>
        <div style="padding: var(--spacing-sm); position: relative; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; background: linear-gradient(180deg, rgba(19, 11, 55, 0.3), rgba(19, 11, 55, 0.5));">
          <div style="display: flex; justify-content: center; align-items: center; margin-bottom: var(--spacing-sm);">
            <div id="challenge-cs-value" style="font-size: var(--font-size-xl); font-weight: var(--font-weight-bold); color: var(--positive-color, #4caf50); text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);">0.0/8</div>
          </div>
          <div style="height: 6px; background-color: rgba(76, 175, 80, 0.1); border-radius: var(--border-radius-sm); overflow: hidden; box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);">
            <div id="challenge-cs-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #4caf50, #80e27e); border-radius: var(--border-radius-sm); transition: width 0.5s ease-out; box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Espacio antes del mensaje motivacional -->
    <div style="height: var(--spacing-sm);"></div>
    
    <!-- Mensaje motivacional -->
    <div style="background: linear-gradient(135deg, rgba(39, 22, 100, 0.6) 0%, rgba(109, 61, 255, 0.3) 100%); border-radius: var(--border-radius-md); padding: var(--spacing-sm) var(--spacing-md); text-align: center; box-shadow: var(--shadow-sm); border: 1px solid rgba(109, 61, 255, 0.2); margin-top: var(--spacing-xs);">
      <div class="flex-row align-center justify-center">
        <div style="width: 18px; height: 18px; margin-right: var(--spacing-xs);">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#bc76ff" stroke-width="2" style="filter: drop-shadow(0 0 2px rgba(188, 118, 255, 0.7));">
            <path d="M12 15V3m0 12l-4-4m4 4l4-4M2 17l.621 2.485A2 2 0 0 0 4.561 21h14.878a2 2 0 0 0 1.94-1.515L22 17"></path>
          </svg>
        </div>
        <div style="font-size: var(--font-size-md); color: var(--omashu-purple-light, #bc76ff); font-weight: var(--font-weight-bold); text-shadow: 0 0 5px rgba(188, 118, 255, 0.5);">Cada objetivo te acerca a la victoria</div>
      </div>
    </div>
    
    <!-- Espacio al final para evitar que se corte contenido -->
    <div style="height: var(--spacing-xs);"></div>
  </div>

</div>

<script>
(function() { // Inicio de IIFE
  // Funci贸n para formatear el tiempo de juego
  function formatGameTime(seconds) {
    if (!seconds && seconds !== 0) return "00:00";
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }

  // Funci贸n para actualizar la barra de progreso
  function updateProgressBar(fillElementId, currentValue, targetValue) {
    const fillElement = document.getElementById(fillElementId);
    if (fillElement) {
      const percentage = targetValue > 0 ? Math.min(100, (currentValue / targetValue) * 100) : 0;
      // Suavizar la animaci贸n
      fillElement.style.transition = 'width 0.5s ease-out';
      fillElement.style.width = `${percentage}%`;
    }
  }

  // nica funci贸n para actualizar la UI (ahora local a la IIFE)
  function updateUI(gameData) {
    const playerNameEl = document.getElementById('player-name');
    const playerRoleEl = document.getElementById('player-role');
    const gameTimeEl = document.getElementById('game-time-value');
    const kdaKillsEl = document.getElementById('kda-kills');
    const kdaDeathsEl = document.getElementById('kda-deaths');
    const kdaAssistsEl = document.getElementById('kda-assists');
    const challengeWardsEl = document.getElementById('challenge-wards-value');
    const challengeKillsEl = document.getElementById('challenge-kills-value');
    const challengeCsEl = document.getElementById('challenge-cs-value');

    if (!gameData) return;

    // Actualizar info jugador
    if (gameData.summoner) {
      if (playerNameEl) playerNameEl.textContent = gameData.summoner.name || "Invocador";
      // Actualizar rol con el texto
      if (playerRoleEl) playerRoleEl.textContent = gameData.summoner.position || gameData.summoner.role || "Rol Principal";
    }

    // Valores actuales para progreso
    let currentKills = 0;
    let currentWards = 0;
    let currentCsPerMinute = 0.0;

    // Actualizar info partida
    if (gameData.match) {
      if (gameTimeEl && gameData.match.gameTime !== undefined) {
        // Usar la funci贸n global formateadora
        gameTimeEl.textContent = window.parent.formatGameTime ? window.parent.formatGameTime(gameData.match.gameTime) : "00:00";
      }
      currentKills = gameData.match.kills ?? 0;
      if (kdaKillsEl) kdaKillsEl.textContent = currentKills;
      if (kdaDeathsEl) kdaDeathsEl.textContent = gameData.match.deaths ?? 0;
      if (kdaAssistsEl) kdaAssistsEl.textContent = gameData.match.assists ?? 0;

      if (challengeKillsEl) {
        challengeKillsEl.textContent = currentKills + "/3";
      }

      if (challengeCsEl && gameData.match.cs !== undefined && gameData.match.gameTime !== undefined && gameData.match.gameTime > 0) {
        const gameTimeInMinutes = gameData.match.gameTime / 60;
        currentCsPerMinute = (gameData.match.cs / gameTimeInMinutes);
        challengeCsEl.textContent = currentCsPerMinute.toFixed(1) + "/8";
      } else if (challengeCsEl) {
        challengeCsEl.textContent = "0.0/8";
      }
    }

    // Actualizar info visi贸n
    if (gameData.vision) {
       currentWards = gameData.vision.wardsPlaced ?? 0;
       if (challengeWardsEl) challengeWardsEl.textContent = currentWards + "/5";
    } else if (challengeWardsEl) {
       challengeWardsEl.textContent = "0/5";
    }

    // Actualizar barras de progreso
    requestAnimationFrame(() => {
        updateProgressBar('challenge-wards-fill', currentWards, 5);
        updateProgressBar('challenge-kills-fill', currentKills, 3);
        updateProgressBar('challenge-cs-fill', currentCsPerMinute, 8);
    });
  }

  // --- INICIALIZACIN Y SUSCRIPCIN ---
  console.log("[tab-overview] Script cargado y ejecut谩ndose.");

  try {
    // 1. Suscribirse a los datos
    if (window.parent && typeof window.parent.subscribeToGameData === 'function') {
      console.log("[tab-overview] Suscribiendo a gameDataManager...");
      window.parent.subscribeToGameData(updateUI);
    } else {
      console.error("[tab-overview] No se pudo encontrar window.parent.subscribeToGameData.");
      // Podr铆amos a帽adir un reintento si fuera necesario
    }

    // 2. Obtener y mostrar datos iniciales
    if (window.parent && typeof window.parent.getGameData === 'function') {
      const initialData = window.parent.getGameData();
      console.log("[tab-overview] Aplicando datos iniciales:", initialData);
      updateUI(initialData);
    } else {
      console.error("[tab-overview] No se pudo encontrar window.parent.getGameData.");
      // Mostrar UI vac铆a o con estado "cargando"
      updateUI({}); 
    }
    
  } catch (error) {
    console.error("[tab-overview] Error durante inicializaci贸n/suscripci贸n:", error);
  }

  // Eliminar l贸gica antigua de DOMContentLoaded y adjuntar updateUIFunction
  /* 
  document.addEventListener('DOMContentLoaded', function() {
    // ... c贸digo eliminado ...
  });
  */

})(); // Fin de IIFE
</script>

<!-- Estilos CSS movidos aqu铆, fuera del script -->
<style>
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
  }
  
  .challenge-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  }
</style> 