<!-- Tab de Resumen - Página principal de la aplicación optimizada con principios de neuromarketing -->
<div class="overview-container">
  <div class="overview-header glass-panel">
    <div class="overview-player">
      <div class="overview-player-profile">
        <div class="overview-player-image shimmer-effect" aria-label="Imagen de perfil del jugador"></div>
        <div class="overview-player-info">
          <h2 id="player-name" class="text-glow">Invocador</h2>
          <div class="overview-player-role">
            <img src="../../img/role-icon.svg" alt="Rol" />
            <span id="player-role">Rol Principal</span>
          </div>
        </div>
      </div>
      <div class="overview-match-info">
        <div class="overview-timer pulse-effect">
          <span class="overview-label">Tiempo de juego:</span>
          <span id="game-time-value" class="highlight-value">00:00</span>
        </div>
        <div class="overview-kda">
          <div class="kda-container">
            <span class="kda-label">K</span>
            <span id="kda-kills" class="kda-value highlight-primary">0</span>
          </div>
          <span class="kda-separator">/</span>
          <div class="kda-container">
            <span class="kda-label">D</span>
            <span id="kda-deaths" class="kda-value highlight-danger">0</span>
          </div>
          <span class="kda-separator">/</span>
          <div class="kda-container">
            <span class="kda-label">A</span>
            <span id="kda-assists" class="kda-value highlight-success">0</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="overview-sections">
    <div class="overview-section glass-panel">
      <div class="overview-section-header">
        <h3>
          <span class="icon-container success-bg">
            <img src="../../img/strength-icon.svg" alt="Fortalezas" />
          </span>
          Fortalezas
        </h3>
        <div class="section-actions">
          <button class="micro-button" aria-label="Más información">
            <i class="icon-info"></i>
          </button>
        </div>
      </div>
      <div class="overview-section-content">
        <div class="overview-stat scale-on-hover">
          <div class="overview-stat-header">
            <div class="overview-stat-icon success-pulse">
              <img src="../../img/accuracy-icon.svg" alt="Precisión" />
            </div>
            <div class="overview-stat-name">Precisión</div>
          </div>
          <div class="overview-stat-value highlight-success">80%</div>
          <div class="overview-stat-desc">Mayor precisión en disparos, 30% por encima del promedio.</div>
        </div>
        
        <div class="overview-stat scale-on-hover">
          <div class="overview-stat-header">
            <div class="overview-stat-icon success-pulse">
              <img src="../../img/reflexes-icon.svg" alt="Reflejos" />
            </div>
            <div class="overview-stat-name">Reflejos</div>
          </div>
          <div class="overview-stat-value highlight-success">15%</div>
          <div class="overview-stat-desc">Tiempo de reacción 15% más rápido que el promedio en tu nivel.</div>
        </div>
        
        <div class="overview-stat scale-on-hover">
          <div class="overview-stat-header">
            <div class="overview-stat-icon success-pulse">
              <img src="../../img/rotations-icon.svg" alt="Rotaciones" />
            </div>
            <div class="overview-stat-name">Rotaciones</div>
          </div>
          <div class="overview-stat-value highlight-success">8</div>
          <div class="overview-stat-desc">8 rotaciones efectivas, contribuyendo a 3 objetivos de equipo.</div>
        </div>
      </div>
    </div>
    
    <div class="overview-section glass-panel">
      <div class="overview-section-header">
        <h3>
          <span class="icon-container warning-bg">
            <img src="../../img/weakness-icon.svg" alt="Debilidades" />
          </span>
          Oportunidades de Mejora
        </h3>
        <div class="section-actions">
          <button class="micro-button" aria-label="Más información">
            <i class="icon-info"></i>
          </button>
        </div>
      </div>
      <div class="overview-section-content">
        <div class="overview-stat scale-on-hover">
          <div class="overview-stat-header">
            <div class="overview-stat-icon warning-pulse">
              <img src="../../img/vision-icon.svg" alt="Visión" />
            </div>
            <div class="overview-stat-name">Visión</div>
          </div>
          <div class="overview-stat-value highlight-warning">25%</div>
          <div class="overview-stat-desc">Menos control de visión que el promedio de tu nivel.</div>
        </div>
        
        <div class="overview-stat scale-on-hover">
          <div class="overview-stat-header">
            <div class="overview-stat-icon warning-pulse">
              <img src="../../img/positioning-icon.svg" alt="Posicionamiento" />
            </div>
            <div class="overview-stat-name">Posicionamiento</div>
          </div>
          <div class="overview-stat-value highlight-warning">67.5%</div>
          <div class="overview-stat-desc">67.5% de muertes por flanqueo, 22% más que el promedio.</div>
        </div>
        
        <div class="overview-stat scale-on-hover">
          <div class="overview-stat-header">
            <div class="overview-stat-icon warning-pulse">
              <img src="../../img/resources-icon.svg" alt="Uso de recursos" />
            </div>
            <div class="overview-stat-name">Uso de recursos</div>
          </div>
          <div class="overview-stat-value highlight-warning">18%</div>
          <div class="overview-stat-desc">Economía 18% menos eficiente que jugadores de tu nivel.</div>
        </div>
      </div>
    </div>
    
    <div class="overview-section glass-panel">
      <div class="overview-section-header">
        <h3>
          <span class="icon-container primary-bg">
            <img src="../../img/challenges-icon.svg" alt="Retos" />
          </span>
          Retos para esta partida
        </h3>
        <div class="section-actions">
          <button class="micro-button pulse-effect" aria-label="Nueva misión">
            <i class="icon-add"></i>
          </button>
        </div>
      </div>
      <div class="overview-section-content challenges">
        <div class="overview-challenge interactive-panel">
          <div class="overview-challenge-icon primary-pulse">
            <img src="../../img/ward-icon.svg" alt="Colocar wards" />
          </div>
          <div class="overview-challenge-info">
            <div class="overview-challenge-name">Coloca 5 wards</div>
            <div class="overview-challenge-progress">
              <div class="progress-bar">
                <div class="progress-fill animate-width" style="width: 2%;"></div>
              </div>
              <div class="progress-text">2%</div>
            </div>
          </div>
        </div>
        
        <div class="overview-challenge interactive-panel">
          <div class="overview-challenge-icon primary-pulse">
            <img src="../../img/survive-icon.svg" alt="Sobrevivir" />
          </div>
          <div class="overview-challenge-info">
            <div class="overview-challenge-name">Sobrevive 3 emboscadas</div>
            <div class="overview-challenge-progress">
              <div class="progress-bar">
                <div class="progress-fill animate-width" style="width: 33%;"></div>
              </div>
              <div class="progress-text">1/3</div>
            </div>
          </div>
        </div>
        
        <div class="overview-challenge interactive-panel">
          <div class="overview-challenge-icon primary-pulse">
            <img src="../../img/economy-icon.svg" alt="Economía" />
          </div>
          <div class="overview-challenge-info">
            <div class="overview-challenge-name">Optimiza compras de objetos</div>
            <div class="overview-challenge-progress">
              <div class="progress-bar">
                <div class="progress-fill animate-width" style="width: 23%;"></div>
              </div>
              <div class="progress-text">23%</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="overview-performance glass-panel">
    <div class="performance-header">
      <h3>Rendimiento General</h3>
      <div class="performance-trend positive">
        <span class="trend-icon">↑</span>
        <span class="trend-value">+5%</span>
      </div>
    </div>
    <div class="overview-rating shimmer-effect">B+</div>
  </div>

  <!-- Notificaciones flotantes emergentes -->
  <div class="notification-container" id="notification-container">
    <!-- Las notificaciones se agregarán dinámicamente -->
  </div>
</div>

<style>
  /* Estilos complementarios para efectos adicionales */
  .glass-panel {
    background: linear-gradient(135deg, rgba(29, 16, 75, 0.7), rgba(19, 11, 55, 0.9));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(109, 61, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }
  
  .text-glow {
    text-shadow: 0 0 10px rgba(109, 61, 255, 0.6);
  }
  
  .highlight-primary {
    color: var(--omashu-purple-light);
    font-weight: var(--font-weight-bold);
  }
  
  .highlight-success {
    color: var(--positive-color);
    font-weight: var(--font-weight-bold);
  }
  
  .highlight-warning {
    color: var(--warning-color);
    font-weight: var(--font-weight-bold);
  }
  
  .highlight-danger {
    color: var(--negative-color);
    font-weight: var(--font-weight-bold);
  }
  
  .highlight-value {
    color: var(--omashu-highlight);
    font-weight: var(--font-weight-bold);
  }
  
  .success-bg {
    background-color: rgba(76, 175, 80, 0.2);
  }
  
  .warning-bg {
    background-color: rgba(255, 183, 77, 0.2);
  }
  
  .primary-bg {
    background-color: rgba(109, 61, 255, 0.2);
  }
  
  .success-pulse {
    animation: pulse-green 2s infinite;
  }
  
  .warning-pulse {
    animation: pulse-gold 2s infinite;
  }
  
  .primary-pulse {
    animation: pulse-blue 2s infinite;
  }
  
  .scale-on-hover {
    transition: transform var(--transition-fast);
  }
  
  .scale-on-hover:hover {
    transform: scale(1.03);
  }
  
  .interactive-panel {
    transition: all var(--transition-fast);
    cursor: pointer;
  }
  
  .interactive-panel:hover {
    background-color: rgba(255, 255, 255, 0.05);
    transform: translateY(-2px);
  }
  
  .kda-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    line-height: 1;
  }
  
  .kda-label {
    font-size: var(--font-size-xs);
    color: var(--text-tertiary);
    margin-bottom: 2px;
  }
  
  .section-actions {
    margin-left: auto;
  }
  
  .micro-button {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  
  .micro-button:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
    border-color: var(--border-active);
  }
  
  .animate-width {
    transition: width 1s ease-in-out;
  }
  
  .performance-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .performance-trend {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--font-size-sm);
  }
  
  .performance-trend.positive {
    color: var(--positive-color);
  }
  
  .performance-trend.negative {
    color: var(--negative-color);
  }
  
  .notification-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: var(--z-index-toast);
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: none;
  }
</style>

<script>
  // Función para formatear el tiempo de juego
  function formatGameTime(seconds) {
    if (!seconds && seconds !== 0) return "00:00";
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }

  // Función para crear y mostrar notificaciones temporales
  function showNotification(message, type = 'info') {
    const container = document.getElementById('notification-container');
    const notification = document.createElement('div');
    notification.className = `notification notification--${type} animate-in`;
    notification.innerHTML = `
      <div class="notification-icon"></div>
      <div class="notification-content">${message}</div>
    `;
    container.appendChild(notification);
    
    // Animar salida y eliminar
    setTimeout(() => {
      notification.classList.add('animate-out');
      setTimeout(() => notification.remove(), 500);
    }, 3000);
  }

  // Función para actualizar los elementos de la UI con los datos del juego
  function updateUI(gameData) {
    console.log('tab-overview: updateUI llamada con datos:', 
      JSON.stringify({
        summoner: gameData.summoner ? gameData.summoner.name : 'no disponible',
        gameTime: gameData.match ? gameData.match.gameTime : 'no disponible',
        kda: gameData.match ? `${gameData.match.kills}/${gameData.match.deaths}/${gameData.match.assists}` : 'no disponible'
      })
    );

    try {
      // Crear un marcador de tiempo para depuración
      const ahora = new Date();
      const tiempoUI = document.createElement('div');
      tiempoUI.style.position = 'absolute';
      tiempoUI.style.top = '5px';
      tiempoUI.style.right = '5px';
      tiempoUI.style.background = 'rgba(0,0,0,0.5)';
      tiempoUI.style.color = 'white';
      tiempoUI.style.padding = '3px 6px';
      tiempoUI.style.borderRadius = '3px';
      tiempoUI.style.fontSize = '10px';
      tiempoUI.style.zIndex = '9999';
      tiempoUI.textContent = `Última actualización: ${ahora.toLocaleTimeString()}.${ahora.getMilliseconds()}`;
      document.querySelector('.overview-container').appendChild(tiempoUI);
      
      // Eliminar marcadores antiguos (mantener solo el último)
      const marcadores = document.querySelectorAll('.overview-container > div[style*="position: absolute"]');
      if (marcadores.length > 1) {
        for (let i = 0; i < marcadores.length - 1; i++) {
          marcadores[i].remove();
        }
      }
      
      // Actualizar nombre del jugador
      if (gameData.summoner && gameData.summoner.name) {
        const playerNameElement = document.getElementById('player-name');
        if (playerNameElement) {
          const oldName = playerNameElement.textContent;
          const newName = gameData.summoner.name || "Desconocido";
          
          if (oldName !== newName) {
            playerNameElement.textContent = newName;
            
            // Actualizar también el icono de jugador con la primera letra
            const playerImageElement = document.querySelector('.overview-player-image');
            if (playerImageElement) {
              playerImageElement.textContent = (newName.charAt(0) || "?").toUpperCase();
            }
            
            // Mostrar notificación de bienvenida la primera vez
            if (oldName === "Invocador") {
              showNotification(`¡Bienvenido, ${newName}! Estamos analizando tu partida en tiempo real.`, 'success');
            }
            
            console.log('Nombre de jugador actualizado:', newName);
          }
        } else {
          console.error('Elemento player-name no encontrado');
        }
        
        // Actualizar rol del jugador si está disponible
        if (gameData.summoner.position || gameData.summoner.role) {
          const playerRoleElement = document.getElementById('player-role');
          if (playerRoleElement) {
            playerRoleElement.textContent = gameData.summoner.position || gameData.summoner.role || "Rol Principal";
          }
        }
      }

      // Actualizar tiempo de juego - MEJORADO para asegurar actualización
      if (gameData.match && gameData.match.gameTime !== undefined) {
        const gameTimeElement = document.getElementById('game-time-value');
        if (gameTimeElement) {
          const formattedTime = formatGameTime(gameData.match.gameTime);
          if (gameTimeElement.textContent !== formattedTime) {
            gameTimeElement.textContent = formattedTime;
            gameTimeElement.setAttribute('data-last-update', Date.now().toString());
            console.log('Tiempo de juego actualizado:', formattedTime);
          }
        } else {
          console.error('Elemento game-time-value no encontrado');
        }
      }

      // Actualizar KDA con atributos para comparar versiones
      if (gameData.match) {
        // Actualizar Kills
        const killsElement = document.getElementById('kda-kills');
        if (killsElement) {
          const killsValue = gameData.match.kills || 0;
          const oldValue = parseInt(killsElement.getAttribute('data-value') || '0');
          
          if (oldValue !== killsValue) {
            killsElement.textContent = killsValue.toString();
            killsElement.setAttribute('data-value', killsValue.toString());
            
            // Si aumentaron las kills, mostrar notificación
            if (oldValue < killsValue) {
              showNotification(`¡Nueva eliminación conseguida!`, 'success');
            }
            
            // Animar el cambio
            killsElement.style.animation = 'none';
            killsElement.offsetHeight; // Forzar reflow
            killsElement.style.animation = 'pulse-red 0.5s';
            
            console.log('Kills actualizadas:', killsValue, '(anterior:', oldValue, ')');
          }
        } else {
          console.error('Elemento kda-kills no encontrado');
        }
        
        // Actualizar Deaths
        const deathsElement = document.getElementById('kda-deaths');
        if (deathsElement) {
          const deathsValue = gameData.match.deaths || 0;
          const oldValue = parseInt(deathsElement.getAttribute('data-value') || '0');
          
          if (oldValue !== deathsValue) {
            deathsElement.textContent = deathsValue.toString();
            deathsElement.setAttribute('data-value', deathsValue.toString());
            
            // Si aumentaron las muertes, mostrar notificación
            if (oldValue < deathsValue) {
              showNotification(`Muerte registrada. ¡Mantén la calma!`, 'warning');
            }
            
            deathsElement.style.animation = 'none';
            deathsElement.offsetHeight; // Forzar reflow
            deathsElement.style.animation = 'pulse-red 0.5s';
            
            console.log('Deaths actualizadas:', deathsValue, '(anterior:', oldValue, ')');
          }
        } else {
          console.error('Elemento kda-deaths no encontrado');
        }
        
        // Actualizar Assists
        const assistsElement = document.getElementById('kda-assists');
        if (assistsElement) {
          const assistsValue = gameData.match.assists || 0;
          const oldValue = parseInt(assistsElement.getAttribute('data-value') || '0');
          
          if (oldValue !== assistsValue) {
            assistsElement.textContent = assistsValue.toString();
            assistsElement.setAttribute('data-value', assistsValue.toString());
            
            // Si aumentaron las asistencias, mostrar notificación
            if (oldValue < assistsValue) {
              showNotification(`¡Nueva asistencia registrada!`, 'info');
            }
            
            assistsElement.style.animation = 'none';
            assistsElement.offsetHeight; // Forzar reflow
            assistsElement.style.animation = 'pulse-green 0.5s';
            
            console.log('Assists actualizadas:', assistsValue, '(anterior:', oldValue, ')');
          }
        } else {
          console.error('Elemento kda-assists no encontrado');
        }
        
        // Actualizar los retos basados en KDA y otras métricas
        updateChallenges(gameData);
      }

      // Añadimos datos de depuración visibles para comprobar la recepción
      document.querySelector('.overview-rating').innerHTML = `B+`;
    } catch (e) {
      console.error('Error al actualizar la UI:', e);
      document.querySelector('.overview-rating').innerHTML = `
        <div style="text-align: center; padding: 5px; background: rgba(255,0,0,0.2); border-radius: 5px; margin-bottom: 5px; font-size: 12px;">
          <strong>Error al actualizar UI:</strong><br>
          ${e.message}<br>
          <small>Última actualización: ${new Date().toLocaleTimeString()}</small>
        </div>
        B+`;
    }
  }
  
  // Función para actualizar los retos basados en los datos del juego
  function updateChallenges(gameData) {
    // Reto: Colocar wards
    if (gameData.objectives && gameData.objectives.wardPlaced !== undefined) {
      const wardProgress = Math.min(gameData.objectives.wardPlaced / 5 * 100, 100);
      const wardProgressBar = document.querySelector('.overview-challenge:nth-child(1) .progress-fill');
      const wardProgressText = document.querySelector('.overview-challenge:nth-child(1) .progress-text');
      
      if (wardProgressBar) {
        wardProgressBar.style.width = `${wardProgress}%`;
      }
      if (wardProgressText) {
        wardProgressText.textContent = `${Math.round(wardProgress)}%`;
      }
    }
    
    // Reto: Supervivencia (basado en ratio K/D bueno)
    if (gameData.match.kills !== undefined && gameData.match.deaths !== undefined) {
      const kdRatio = gameData.match.deaths > 0 ? gameData.match.kills / gameData.match.deaths : gameData.match.kills;
      const survivalScore = Math.min(kdRatio, 3); // Máx 3
      const survivalProgress = (survivalScore / 3) * 100;
      
      const survivalProgressBar = document.querySelector('.overview-challenge:nth-child(2) .progress-fill');
      const survivalProgressText = document.querySelector('.overview-challenge:nth-child(2) .progress-text');
      
      if (survivalProgressBar) {
        survivalProgressBar.style.width = `${survivalProgress}%`;
      }
      if (survivalProgressText) {
        survivalProgressText.textContent = `${Math.min(Math.round(survivalScore), 3)}/3`;
      }
    }
    
    // Reto: Economía (basado en oro y cs)
    if (gameData.match.gold !== undefined && gameData.match.cs !== undefined) {
      // Simple cálculo de eficiencia: oro por minion
      const goldPerCS = gameData.match.cs > 0 ? gameData.match.gold / gameData.match.cs : 0;
      // Normalizar a un porcentaje (considerando 25 oro por minion como 100%)
      const economyRatio = Math.min((goldPerCS / 25) * 100, 100);
      
      const economyProgressBar = document.querySelector('.overview-challenge:nth-child(3) .progress-fill');
      const economyProgressText = document.querySelector('.overview-challenge:nth-child(3) .progress-text');
      
      if (economyProgressBar) {
        economyProgressBar.style.width = `${economyRatio}%`;
      }
      if (economyProgressText) {
        economyProgressText.textContent = `${Math.round(economyRatio)}%`;
      }
    }
    
    // Comprobar si algún reto está completo (100%)
    document.querySelectorAll('.progress-fill').forEach(progressBar => {
      const width = parseFloat(progressBar.style.width);
      if (width >= 100) {
        // Añadir clase de completado si no la tiene
        const challenge = progressBar.closest('.overview-challenge');
        if (challenge && !challenge.classList.contains('challenge-completed')) {
          challenge.classList.add('challenge-completed');
          // Mostrar notificación de reto completado
          const challengeName = challenge.querySelector('.overview-challenge-name').textContent;
          showNotification(`¡Reto completado! ${challengeName}`, 'success');
        }
      }
    });
  }

  // Verificar y suscribirse a los datos del juego con métodos mejorados
  function initGameDataSubscription() {
    console.log('tab-overview: Intentando inicializar suscripción a datos del juego');
    
    // ---- NUEVO MÉTODO: Leer datos desde archivo ----
    function readGameDataFromFile() {
      // Leer datos de archivo temporal (varios intentos para asegurar compatibilidad)
      const possiblePaths = [
        overwolf.io.paths.localAppData + '\\Overwolf\\eMePe-AppData\\lol-game-data.json',
        overwolf.io.paths.localAppData + '\\Overwolf\\eMePe-AppData\\lol-game-data-backup.json',
        overwolf.io.paths.documents + '\\Overwolf\\lol-game-data.json'
      ];
      
      // Función para intentar leer cada archivo en secuencia
      function tryReadFile(index) {
        if (index >= possiblePaths.length) {
          console.log('No se encontraron archivos de datos de juego');
          return;
        }
        
        const path = possiblePaths[index];
        overwolf.io.fileExists(path, (existsResult) => {
          if (existsResult.success && existsResult.exists) {
            overwolf.io.readFileContents(path, 'UTF8', (readResult) => {
              if (readResult.success) {
                try {
                  const gameData = JSON.parse(readResult.content);
                  console.log('Datos leídos exitosamente del archivo:', path);
                  console.log('Datos de juego:', {
                    nombre: gameData.summoner.name,
                    champion: gameData.summoner.champion,
                    kda: `${gameData.match.kills}/${gameData.match.deaths}/${gameData.match.assists}`,
                    tiempo: gameData.match.gameTime
                  });
                  updateUI(gameData);
                } catch (e) {
                  console.error('Error al parsear datos del archivo:', e);
                  // Intenta el siguiente archivo
                  tryReadFile(index + 1);
                }
              } else {
                console.error('Error al leer el archivo:', readResult.error);
                // Intenta el siguiente archivo
                tryReadFile(index + 1);
              }
            });
          } else {
            console.log(`Archivo no encontrado: ${path}`);
            // Intenta el siguiente archivo
            tryReadFile(index + 1);
          }
        });
      }
      
      // Iniciar intentos de lectura
      tryReadFile(0);
      
      // Comprobar periódicamente el archivo
      setTimeout(readGameDataFromFile, 1000);
    }
    
    // Iniciar lectura de archivo
    readGameDataFromFile();
    
    // Mantener métodos anteriores también
    function checkLocalStorage() {
      try {
        const storedData = localStorage.getItem('lol_game_data');
        if (storedData) {
          console.log('Datos encontrados en localStorage');
          const gameData = JSON.parse(storedData);
          updateUI(gameData);
        }
      } catch (e) {
        console.error('Error al leer de localStorage:', e);
      }
    }
    
    // Verificar localStorage cada 2 segundos
    setInterval(checkLocalStorage, 2000);
    
    // Escuchar mensajes directos
    function setupDirectMessageListener() {
      overwolf.windows.onMessageReceived.removeListener(handleDirectMessage);
      overwolf.windows.onMessageReceived.addListener(handleDirectMessage);
      console.log('Listener de mensajes directos configurado');
    }
    
    function handleDirectMessage(message) {
      console.log('Mensaje directo recibido:', message);
      if (message && message.id === 'game_data_update' && message.content) {
        console.log('Actualizando UI desde mensaje directo');
        updateUI(message.content);
      }
    }
    
    // Configurar el listener para mensajes directos
    setupDirectMessageListener();
    
    // Verificar datos en la ventana principal periódicamente
    function checkMainWindowData() {
      overwolf.windows.getMainWindow(function(mainWindow) {
        if (mainWindow && mainWindow._latestGameData) {
          console.log('Datos encontrados en mainWindow._latestGameData');
          updateUI(mainWindow._latestGameData);
        }
      });
    }
    
    // Comprobar datos de la ventana principal cada 2 segundos
    setInterval(checkMainWindowData, 2000);
  }

  // Inicializa la suscripción a los datos del juego
  document.addEventListener('DOMContentLoaded', function() {
    console.log('tab-overview: DOM cargado, intentando conectar con gameDataManager...');
    
    // MÉTODO DIRECTO: Intentar obtener el gameDataManager de la ventana padre
    try {
      // Método 1: Suscribirse directamente usando window.subscribeToGameData (método expuesto)
      if (typeof window.subscribeToGameData === 'function') {
        console.log('tab-overview: Usando window.subscribeToGameData...');
        window.subscribeToGameData(updateUI);
        
        // Mostrar notificación de bienvenida
        setTimeout(() => {
          showNotification('Análisis de partida iniciado. ¡Buena suerte!', 'info');
        }, 1000);
        
        console.log('tab-overview: Conexión exitosa con gameDataManager');
      } 
      // Método 2: Usar el objeto global gameDataManager directamente
      else if (window.gameDataManager && typeof window.gameDataManager.subscribe === 'function') {
        console.log('tab-overview: Usando window.gameDataManager.subscribe...');
        window.gameDataManager.subscribe(updateUI);
        
        // Mostrar notificación de bienvenida
        setTimeout(() => {
          showNotification('Análisis de partida iniciado. ¡Buena suerte!', 'info');
        }, 1000);
        
        console.log('tab-overview: Conexión exitosa con gameDataManager.subscribe');
      } 
      // Método 3: Acceder a través de la ventana principal
      else {
        console.log('tab-overview: Accediendo a gameDataManager a través de overwolf.windows.getMainWindow...');
        overwolf.windows.getMainWindow(function(mainWindow) {
          if (mainWindow && mainWindow.gameDataManager && typeof mainWindow.gameDataManager.subscribe === 'function') {
            console.log('tab-overview: Acceso exitoso a gameDataManager a través de getMainWindow');
            mainWindow.gameDataManager.subscribe(updateUI);
            
            // Mostrar notificación de bienvenida
            setTimeout(() => {
              showNotification('Análisis de partida iniciado. ¡Buena suerte!', 'info');
            }, 1000);
          } else {
            console.error('tab-overview: No se pudo acceder a gameDataManager desde la ventana principal');
            // Si falla, iniciar los métodos anteriores
            initGameDataSubscription();
          }
        });
      }
    } catch (e) {
      console.error('tab-overview: Error al conectar con gameDataManager:', e);
      
      // Si falla, iniciar los métodos anteriores
      initGameDataSubscription();
    }
    
    // Simular interacción para pruebas
    document.querySelectorAll('.overview-challenge').forEach(challenge => {
      challenge.addEventListener('click', () => {
        const challengeName = challenge.querySelector('.overview-challenge-name').textContent;
        showNotification(`Reto seleccionado: ${challengeName}`, 'info');
      });
    });
  });
</script> 