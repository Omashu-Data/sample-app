<!-- Tab de Estadísticas - Diseño Mejorado -->
<div class="stats-container layout-column" style="background: var(--background-primary, #090521); color: var(--text-primary, #fff); padding: var(--spacing-md) var(--spacing-lg); gap: var(--spacing-md);">

  <!-- Encabezado con nombre del jugador y tiempo de partida -->
  <div class="stats-header" style="background: linear-gradient(to right, rgba(19, 11, 55, 0.95), rgba(39, 22, 100, 0.85)); border-radius: var(--border-radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-sm); box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.2);">
    <div class="stats-title flex-row align-center justify-between">
      <div>
        <h2 style="color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.5); margin: 0; font-size: var(--font-size-xl);">Estadísticas de <span id="stats-player-name" style="font-weight: var(--font-weight-bold);">Invocador</span></h2>
        <div class="stats-subtitle" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-top: var(--spacing-xs);">
          <span id="stats-match-type">Partida Normal</span> - <span id="stats-game-time" style="color: var(--omashu-active, #7747ea); text-shadow: 0 0 5px rgba(119, 71, 234, 0.3);">00:00</span>
          <span style="font-size: var(--font-size-xs); padding: 2px 8px; background: linear-gradient(to right, #6d3dff, #7747ea); border-radius: var(--border-radius-round); animation: pulse 2s infinite; margin-left: var(--spacing-sm); box-shadow: 0 0 12px rgba(109, 61, 255, 0.5);">EN VIVO</span>
        </div>
      </div>
    </div>
  </div>
    
  <div class="stats-sections layout-column" style="gap: var(--spacing-md);">
    <!-- Sección de KDA Detallado -->
    <div class="stats-section" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.15);">
      <div class="stats-section-header" style="padding: var(--spacing-sm) var(--spacing-md); border-bottom: 1px solid rgba(109, 61, 255, 0.15); background: rgba(109, 61, 255, 0.1);">
        <h3 style="font-size: var(--font-size-md); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.3); margin: 0; font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px;">Desempeño en Combate</h3>
      </div>
      <div class="stats-section-content" style="padding: var(--spacing-md);">
        <div class="stats-kda-container" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-md);">
          <div class="stats-kda-card" style="background: rgba(19, 11, 55, 0.5); padding: var(--spacing-md); border-radius: var(--border-radius-md); text-align: center; display: flex; flex-direction: column; gap: var(--spacing-xs); transition: transform 0.2s ease; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <div id="stats-kills" class="stats-kda-value" style="font-size: var(--font-size-xxl); font-weight: var(--font-weight-bold); color: var(--positive-color, #4caf50); text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);">0</div>
            <div class="stats-kda-label" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.5px;">Eliminaciones</div>
        </div>
          <div class="stats-kda-card" style="background: rgba(19, 11, 55, 0.5); padding: var(--spacing-md); border-radius: var(--border-radius-md); text-align: center; display: flex; flex-direction: column; gap: var(--spacing-xs); transition: transform 0.2s ease; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <div id="stats-deaths" class="stats-kda-value" style="font-size: var(--font-size-xxl); font-weight: var(--font-weight-bold); color: var(--negative-color, #f44336); text-shadow: 0 0 8px rgba(244, 67, 54, 0.5);">0</div>
            <div class="stats-kda-label" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.5px;">Muertes</div>
      </div>
          <div class="stats-kda-card" style="background: rgba(19, 11, 55, 0.5); padding: var(--spacing-md); border-radius: var(--border-radius-md); text-align: center; display: flex; flex-direction: column; gap: var(--spacing-xs); transition: transform 0.2s ease; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <div id="stats-assists" class="stats-kda-value" style="font-size: var(--font-size-xxl); font-weight: var(--font-weight-bold); color: var(--info-color, #29b6f6); text-shadow: 0 0 8px rgba(41, 182, 246, 0.5);">0</div>
            <div class="stats-kda-label" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.5px;">Asistencias</div>
        </div>
          <div class="stats-kda-card" style="background: rgba(19, 11, 55, 0.5); padding: var(--spacing-md); border-radius: var(--border-radius-md); text-align: center; display: flex; flex-direction: column; gap: var(--spacing-xs); transition: transform 0.2s ease; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <div id="stats-kda-ratio" class="stats-kda-value" style="font-size: var(--font-size-xxl); font-weight: var(--font-weight-bold); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 8px rgba(188, 118, 255, 0.5);">0.0</div>
            <div class="stats-kda-label" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.5px;">Ratio KDA</div>
      </div>
        </div>
      </div>
    </div>
    
    <!-- Sección de Recursos -->
    <div class="stats-section" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.15); margin-top: var(--spacing-md);">
      <div class="stats-section-header" style="padding: var(--spacing-sm) var(--spacing-md); border-bottom: 1px solid rgba(109, 61, 255, 0.15); background: rgba(109, 61, 255, 0.1);">
        <h3 style="font-size: var(--font-size-md); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.3); margin: 0; font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px;">Recursos y Economía</h3>
      </div>
      <div class="stats-section-content" style="padding: var(--spacing-md);">
        <div class="stats-metrics-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md);">
          
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(255, 193, 7, 0.8);">
            <div class="stats-metric-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 193, 7, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);">
              <img src="../../img/gold-icon.svg" alt="Oro" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(255, 193, 7, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Oro Total</div>
              <div id="stats-gold" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #FFC107; text-shadow: 0 0 8px rgba(255, 193, 7, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(76, 175, 80, 0.8);">
            <div class="stats-metric-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);">
              <img src="../../img/cs-icon.svg" alt="CS" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(76, 175, 80, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">CS Total</div>
              <div id="stats-cs" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #4CAF50; text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(76, 175, 80, 0.8);">
            <div class="stats-metric-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);">
              <img src="../../img/cs-per-min-icon.svg" alt="CS por minuto" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(76, 175, 80, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">CS por Minuto</div>
              <div id="stats-cs-per-min" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #4CAF50; text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);">0.0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(109, 61, 255, 0.8);">
            <div class="stats-metric-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(109, 61, 255, 0.2), rgba(109, 61, 255, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(109, 61, 255, 0.3);">
              <img src="../../img/ward-icon.svg" alt="Wards" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(109, 61, 255, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Wards Colocados</div>
              <div id="stats-wards-placed" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 8px rgba(188, 118, 255, 0.5);">0</div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
    
    <!-- Sección de Daño -->
    <div class="stats-section" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.15); margin-top: var(--spacing-md);">
      <div class="stats-section-header" style="padding: var(--spacing-sm) var(--spacing-md); border-bottom: 1px solid rgba(109, 61, 255, 0.15); background: rgba(109, 61, 255, 0.1);">
        <h3 style="font-size: var(--font-size-md); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.3); margin: 0; font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px;">Análisis de Daño</h3>
      </div>
      <div class="stats-section-content" style="padding: var(--spacing-md);">
        <div class="stats-metrics-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md);">
          
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(233, 30, 99, 0.8);">
            <div class="stats-metric-icon damage-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(233, 30, 99, 0.2), rgba(233, 30, 99, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(233, 30, 99, 0.3);">
              <img src="../../img/damage-icon.svg" alt="Daño" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(233, 30, 99, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Daño Total</div>
              <div id="stats-total-damage" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #E91E63; text-shadow: 0 0 8px rgba(233, 30, 99, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(244, 67, 54, 0.8);">
            <div class="stats-metric-icon damage-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(244, 67, 54, 0.2), rgba(244, 67, 54, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(244, 67, 54, 0.3);">
              <img src="../../img/champion-damage-icon.svg" alt="Daño a campeones" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(244, 67, 54, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Daño a Campeones</div>
              <div id="stats-champion-damage" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #F44336; text-shadow: 0 0 8px rgba(244, 67, 54, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(76, 175, 80, 0.8);">
            <div class="stats-metric-icon heal-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);">
              <img src="../../img/healing-icon.svg" alt="Curación" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(76, 175, 80, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Curación Total</div>
              <div id="stats-total-healing" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #4CAF50; text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(255, 152, 0, 0.8);">
            <div class="stats-metric-icon damage-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(255, 152, 0, 0.2), rgba(255, 152, 0, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(255, 152, 0, 0.3);">
              <img src="../../img/damage-taken-icon.svg" alt="Daño recibido" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(255, 152, 0, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Daño Recibido</div>
              <div id="stats-damage-taken" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #FF9800; text-shadow: 0 0 8px rgba(255, 152, 0, 0.5);">0</div>
            </div>
          </div>
            
        </div>
      </div>
    </div>
    
    <!-- NUEVA SECCIÓN: TABLA DE VARIABLES -->
    <div class="stats-section" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.15); margin-top: var(--spacing-md);">
      <div class="stats-section-header" style="padding: var(--spacing-sm) var(--spacing-md); border-bottom: 1px solid rgba(109, 61, 255, 0.15); background: rgba(109, 61, 255, 0.1); display: flex; justify-content: space-between; align-items: center;">
        <h3 style="font-size: var(--font-size-md); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.3); margin: 0; font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px;">Variables del Juego</h3>
        <div style="display: flex; gap: 10px;">
          <button id="btn-exportar-vars" style="background: linear-gradient(135deg, #2e7d32, #43a047); color: white; border: none; padding: 6px 12px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: var(--font-weight-bold); font-size: var(--font-size-sm); display: flex; align-items: center; gap: 5px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Exportar JSON
          </button>
        </div>
      </div>
      <div class="stats-section-content" style="padding: var(--spacing-md);">
        <div class="variables-wrapper" style="max-height: 400px; overflow-y: auto; background: rgba(13, 7, 35, 0.6); border-radius: var(--border-radius-md); border: 1px solid rgba(109, 61, 255, 0.1); box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);">
          <table id="tabla-variables" style="width: 100%; border-collapse: collapse; font-size: var(--font-size-sm);">
            <thead>
              <tr style="background: linear-gradient(90deg, rgba(39, 22, 100, 0.9), rgba(39, 22, 100, 0.7)); position: sticky; top: 0; z-index: 1; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                <th style="padding: 10px 12px; text-align: left; color: var(--omashu-purple-light, #bc76ff); font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid rgba(109, 61, 255, 0.3);">Variable</th>
                <th style="padding: 10px 12px; text-align: left; color: var(--omashu-purple-light, #bc76ff); font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid rgba(109, 61, 255, 0.3);">Valor</th>
              </tr>
            </thead>
            <tbody id="variables-body" style="color: var(--text-primary, #fff);">
              <!-- Aquí se insertarán dinámicamente las variables -->
              <tr>
                <td colspan="2" style="text-align: center; padding: 30px; font-size: var(--font-size-md); color: var(--text-secondary, rgba(255,255,255,0.65));">
                  <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.6;">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="8" x2="12" y2="12"></line>
                      <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    Cargando variables...
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- CONTENEDOR ADICIONAL PARA DEBUG DE VARIABLES EN TEXTO PLANO -->
    <div id="plain-text-variables-debug" style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: rgba(0,0,0,0.4); border-radius: var(--border-radius-md); border: 1px dashed #888; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 11px; color: #ccc; line-height: 1.4;">
      <h4 style="margin: 0 0 10px 0; color: #FF9800; border-bottom: 1px solid #555; padding-bottom: 5px;">DEBUG: Rutas de Variables (Texto Plano)</h4>
      <!-- Las rutas se insertarán aquí -->
    </div>

  </div>
</div>

<script>
(function() { // Inicio de IIFE

  // --- Funciones Locales ---
  // function formatGameTime(seconds) { ... } // Eliminada, usar window.parent.formatGameTime

  function formatNumber(num) {
    return new Intl.NumberFormat('es-ES').format(num ?? 0); // Añadir ?? 0 para seguridad
  }

  function calculateKDARatio(kills, deaths, assists) {
    const k = kills ?? 0;
    const d = deaths ?? 0;
    const a = assists ?? 0;
    if (d === 0) return ((k + a) > 0 ? "Perfect" : "0.0");
    return ((k + a) / d).toFixed(1);
  }
  
  let ultimosDatos = {};

  // Función principal para actualizar TODA la UI de la pestaña Stats
  function updateUI(gameData) {
    console.log("[tab-stats] updateUI llamada con datos:", gameData ? 'Presentes' : 'Ausentes');
    const data = gameData || {}; // Usar objeto vacío si no hay datos
    ultimosDatos = JSON.parse(JSON.stringify(data)); // Guardar para exportar

    // Elementos de la UI
    const playerNameEl = document.getElementById('stats-player-name');
    const matchTypeEl = document.getElementById('stats-match-type');
    const gameTimeEl = document.getElementById('stats-game-time');
    const killsEl = document.getElementById('stats-kills');
    const deathsEl = document.getElementById('stats-deaths');
    const assistsEl = document.getElementById('stats-assists');
    const kdaRatioEl = document.getElementById('stats-kda-ratio');
    const goldEl = document.getElementById('stats-gold');
    const csEl = document.getElementById('stats-cs');
    const csPerMinEl = document.getElementById('stats-cs-per-min');
    const wardsEl = document.getElementById('stats-wards-placed');
    const totalDamageEl = document.getElementById('stats-total-damage');
    const championDamageEl = document.getElementById('stats-champion-damage');
    const totalHealingEl = document.getElementById('stats-total-healing');
    const damageTakenEl = document.getElementById('stats-damage-taken');
    const tbody = document.getElementById('variables-body');
    const plainTextOutput = document.getElementById('plain-text-variables-debug');

    // --- Actualizar Encabezado ---
    if (playerNameEl && data.summoner) playerNameEl.textContent = data.summoner.name || "Invocador";
    if (matchTypeEl && data.match) matchTypeEl.textContent = data.match.gameMode || "Partida";
    if (gameTimeEl && data.match?.gameTime !== undefined) {
        gameTimeEl.textContent = window.parent?.formatGameTime ? window.parent.formatGameTime(data.match.gameTime) : "00:00";
    } else if (gameTimeEl) {
        gameTimeEl.textContent = "00:00";
    }

    // --- Actualizar KDA ---
    const kills = data.match?.kills;
    const deaths = data.match?.deaths;
    const assists = data.match?.assists;
    if (killsEl) killsEl.textContent = formatNumber(kills);
    if (deathsEl) deathsEl.textContent = formatNumber(deaths);
    if (assistsEl) assistsEl.textContent = formatNumber(assists);
    if (kdaRatioEl) kdaRatioEl.textContent = calculateKDARatio(kills, deaths, assists);

    // --- Actualizar Recursos ---
    if (goldEl && data.match) goldEl.textContent = formatNumber(data.match.gold);
    const cs = data.match?.cs;
    if (csEl) csEl.textContent = formatNumber(cs);
    if (csPerMinEl && data.match?.gameTime > 0 && cs !== undefined) {
        const csPerMinute = (cs / (data.match.gameTime / 60)).toFixed(1);
        csPerMinEl.textContent = csPerMinute;
    } else if (csPerMinEl) {
        csPerMinEl.textContent = "0.0";
    }
    const wardsPlaced = data.vision?.wardsPlaced ?? data.objectives?.wardPlaced;
    if (wardsEl) wardsEl.textContent = formatNumber(wardsPlaced);

    // --- Actualizar Daño y Curación ---
    if (totalDamageEl && data.combat) totalDamageEl.textContent = formatNumber(data.combat.damageDealt);
    if (championDamageEl && data.combat) championDamageEl.textContent = formatNumber(data.combat.damageDealtToChampions ?? data.combat.totalDamageToChampions);
    if (totalHealingEl && data.combat) totalHealingEl.textContent = formatNumber(data.combat.healing ?? data.combat.healingDone);
    if (damageTakenEl && data.combat) damageTakenEl.textContent = formatNumber(data.combat.damageTaken);

    // --- Actualizar Tabla de Variables y Debug ---
    if (tbody) actualizarTablaHTML(tbody, data);
    if (plainTextOutput) actualizarDebugTextoPlano(plainTextOutput, data);
  }

  // Función auxiliar para generar filas de la tabla HTML
  function actualizarTablaHTML(tbody, gameData) {
    if (!tbody) return;
    tbody.innerHTML = ''; // Limpiar tabla
    let rowCount = 0;

    function generateTableRows(obj, prefix = '') {
        if (!obj || typeof obj !== 'object' || rowCount >= 100) return;
        // Añadimos un chequeo extra para evitar iterar sobre arrays grandes o muy anidados
        if (Array.isArray(obj) && obj.length > 20) { // Limitar arrays grandes
            console.warn(`[TableGen] Array grande (${prefix || 'root'}) omitido para renderizado.`);
        return;
      }
        if (prefix.split('.').length > 6) { // Limitar profundidad
            console.warn(`[TableGen] Profundidad excesiva (${prefix}) omitida.`);
          return;
        }
        
        const keys = Object.keys(obj).sort();
        for (const key of keys) {
            if (rowCount >= 100) break;
            const value = obj[key];
            const fullName = prefix ? `${prefix}.${key}` : key;

            // Omitir ciertas claves internas o muy largas
            if (key === 'listeners' || key === 'events') continue; 
            if (fullName.length > 80) continue; 

            const row = document.createElement('tr');
            row.style.borderBottom = '1px solid #333';

            const nameCell = document.createElement('td');
            nameCell.style.padding = '6px';
            nameCell.style.fontWeight = 'bold';
            nameCell.style.wordBreak = 'break-all'; // Para nombres largos
            nameCell.textContent = fullName;

            const valueCell = document.createElement('td');
            valueCell.style.padding = '6px';
            valueCell.style.wordBreak = 'break-all'; // Para valores largos

            if (value === null) {
                valueCell.textContent = 'null';
                valueCell.style.color = '#888';
            } else if (value === undefined) {
                valueCell.textContent = 'undefined';
                valueCell.style.color = '#888';
            } else if (typeof value === 'object') {
                if (Array.isArray(value)) {
                    // Mostrar solo longitud si es array
                    valueCell.textContent = `Array[${value.length}]`;
                    valueCell.style.color = '#5F9EA0';
                    // No expandir arrays en la tabla por simplicidad
                } else {
                    // Mostrar tipo objeto y número de props
                    valueCell.textContent = `Object{${Object.keys(value).length} props}`;
                    valueCell.style.color = '#7B68EE';
                    // Llamada recursiva para objetos anidados
                    generateTableRows(value, fullName);
              }
            } else {
                valueCell.textContent = String(value).substring(0, 100); // Limitar longitud string
                 if (String(value).length > 100) valueCell.textContent += '...';
                if (typeof value === 'boolean') {
                    valueCell.style.color = value ? '#4CAF50' : '#F44336';
                } else if (typeof value === 'number') {
                    valueCell.style.color = '#03A9F4';
                }
            }

            row.appendChild(nameCell);
            row.appendChild(valueCell);
            tbody.appendChild(row);
            rowCount++;
        }
    }

    try {
        generateTableRows(gameData);
    } catch (e) {
        console.error("[TableGen] Error generando filas:", e);
        tbody.innerHTML = `<tr><td colspan="2" style="color: red;">Error al generar tabla: ${e.message}</td></tr>`;
    }

    if (rowCount === 0) {
        tbody.innerHTML = '<tr><td colspan="2" style="text-align: center; padding: 20px;">Esperando datos...</td></tr>';
    }
  }

  // Función auxiliar para actualizar el debug de texto plano
  function actualizarDebugTextoPlano(outputElement, gameData) {
      if (!outputElement) return;
      const titleElement = outputElement.querySelector('h4');
      outputElement.innerHTML = ''; // Limpiar contenido anterior
      if (titleElement) outputElement.appendChild(titleElement); // Restaurar título

      let paths = [];
      function findPaths(obj, currentPath = '') {
          if (!obj || typeof obj !== 'object' || currentPath.split('.').length > 6) return; // Limitar profundidad
          Object.keys(obj).forEach(key => {
              const newPath = currentPath ? `${currentPath}.${key}` : key;
              // Omitir claves internas/largas también aquí
               if (key === 'listeners' || key === 'events' || newPath.length > 80) return;
              paths.push(newPath);
              if (typeof obj[key] === 'object' && !Array.isArray(obj[key])) {
                  findPaths(obj[key], newPath);
              } else if (Array.isArray(obj[key]) && obj[key].length > 0 && typeof obj[key][0] === 'object') {
                  findPaths(obj[key][0], `${newPath}[0]`);
              }
          });
      }
      try {
          findPaths(gameData);
          paths.sort();
          const pre = document.createElement('pre');
          pre.textContent = paths.join('\n');
          outputElement.appendChild(pre);
      } catch (e) {
          console.error("[DebugText] Error generando rutas:", e);
          outputElement.innerHTML += `<div style="color:red">Error: ${e.message}</div>`;
      }
  }
  
  // --- Lógica de Exportación (sin cambios) --- 
    const btnExportar = document.getElementById('btn-exportar-vars');
  if (btnExportar) {
      btnExportar.addEventListener('click', () => {
          try {
      const jsonStr = JSON.stringify(ultimosDatos, null, 2);
              const blob = new Blob([jsonStr], {type: 'application/json'});
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `stats-data-${new Date().toISOString().replace(/:/g, '-')}.json`; // Nombre de archivo mejorado
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
          } catch (e) { console.error("Error exportando JSON:", e); }
      });
  } else { console.warn("Botón de exportar no encontrado"); }

  // --- INICIALIZACIÓN Y SUSCRIPCIÓN ---
  console.log("[tab-stats] Script cargado y ejecutándose.");
  try {
    if (window.parent && typeof window.parent.subscribeToGameData === 'function') {
      console.log("[tab-stats] Suscribiendo a gameDataManager...");
      window.parent.subscribeToGameData(updateUI);
          } else {
      console.error("[tab-stats] No se pudo encontrar window.parent.subscribeToGameData.");
    }

    if (window.parent && typeof window.parent.getGameData === 'function') {
      const initialData = window.parent.getGameData();
      console.log("[tab-stats] Aplicando datos iniciales:", initialData);
      updateUI(initialData);
    } else {
      console.error("[tab-stats] No se pudo encontrar window.parent.getGameData.");
      updateUI(null); // Pasar null explícitamente si no hay datos
    }
  } catch (error) {
    console.error("[tab-stats] Error durante inicialización/suscripción:", error);
  }

})(); // Fin de IIFE

</script>

<!-- Estilos movidos fuera y después del script -->
<style>
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
  }
  
  .stats-kda-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  }
  /* Estilos para filas de la tabla de variables */
  #tabla-variables tbody tr {
    border-bottom: 1px solid rgba(109, 61, 255, 0.1);
    transition: background-color 0.2s ease;
  }
  
  #tabla-variables tbody tr:hover {
    background-color: rgba(109, 61, 255, 0.1);
  }
  
  /* Estilos para el botón de exportar */
  #btn-exportar-vars:hover {
    background: linear-gradient(135deg, #43a047, #66bb6a);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
  }
  
  #btn-exportar-vars:active {
    transform: translateY(0px);
  }
  
  /* Estilos para la barra de desplazamiento */
  .variables-wrapper::-webkit-scrollbar {
    width: 8px;
  }
  
  .variables-wrapper::-webkit-scrollbar-track {
    background: rgba(13, 7, 35, 0.3);
    border-radius: 4px;
  }
  
  .variables-wrapper::-webkit-scrollbar-thumb {
    background: rgba(109, 61, 255, 0.3);
    border-radius: 4px;
  }
  
  .variables-wrapper::-webkit-scrollbar-thumb:hover {
    background: rgba(109, 61, 255, 0.5);
  }
  
  /* Efectos hover para métricas */
  .stats-metric:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  }

  /* Estilos para tags de valor */
  .valor-tag {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 8px;
    border-radius: 4px;
    border: 1px solid transparent;
    font-size: var(--font-size-xs);
  }

  .valor-tag svg {
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
    opacity: 0.8;
  }

  .valor-array {
    background: rgba(95, 158, 160, 0.1);
    color: #5F9EA0;
    border-color: rgba(95, 158, 160, 0.2);
  }

  .valor-object {
    background: rgba(123, 104, 238, 0.1);
    color: #7B68EE;
    border-color: rgba(123, 104, 238, 0.2);
  }

  .valor-boolean {
    /* Estilos ya definidos inline por simplicidad */
  }

  .valor-number {
    background: rgba(3, 169, 244, 0.1);
    color: #03A9F4;
    border-color: rgba(3, 169, 244, 0.2);
  }

  .valor-string {
    background: rgba(255, 255, 255, 0.08);
    color: white;
    border-color: rgba(255, 255, 255, 0.15);
  }
  
  /* ANIMACIONES ADICIONALES */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .stats-metric-value, .stats-kda-value {
    animation: fadeInUp 0.5s ease-out;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .stats-section {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .stats-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
  }

  .stats-header::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
      rgba(109, 61, 255, 0) 0%, 
      rgba(109, 61, 255, 0.05) 50%, 
      rgba(109, 61, 255, 0) 100%);
    animation: shimmer 3s infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
</style> 