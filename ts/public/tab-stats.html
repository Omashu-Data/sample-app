<!-- Tab de Estadísticas - Diseño Mejorado -->
<div class="stats-container layout-column" style="background: var(--background-primary, #090521); color: var(--text-primary, #fff); padding: var(--spacing-md) var(--spacing-lg); gap: var(--spacing-md);">

  <!-- Encabezado con nombre del jugador y tiempo de partida -->
  <div class="stats-header" style="background: linear-gradient(to right, rgba(19, 11, 55, 0.95), rgba(39, 22, 100, 0.85)); border-radius: var(--border-radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-sm); box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.2);">
    <div class="stats-title flex-row align-center justify-between">
      <div>
        <h2 style="color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.5); margin: 0; font-size: var(--font-size-xl);">Estadísticas de <span id="stats-player-name" style="font-weight: var(--font-weight-bold);">Invocador</span></h2>
        <div class="stats-subtitle" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-top: var(--spacing-xs);">
          <span id="stats-match-type">Partida Normal</span> - <span id="stats-game-time" style="color: var(--omashu-active, #7747ea); text-shadow: 0 0 5px rgba(119, 71, 234, 0.3);">00:00</span>
          <span style="font-size: var(--font-size-xs); padding: 2px 8px; background: linear-gradient(to right, #6d3dff, #7747ea); border-radius: var(--border-radius-round); animation: pulse 2s infinite; margin-left: var(--spacing-sm); box-shadow: 0 0 12px rgba(109, 61, 255, 0.5);">EN VIVO</span>
        </div>
      </div>
    </div>
  </div>
    
  <div class="stats-sections layout-column" style="gap: var(--spacing-md);">
    <!-- Sección de KDA Detallado -->
    <div class="stats-section" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.15);">
      <div class="stats-section-header" style="padding: var(--spacing-sm) var(--spacing-md); border-bottom: 1px solid rgba(109, 61, 255, 0.15); background: rgba(109, 61, 255, 0.1);">
        <h3 style="font-size: var(--font-size-md); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.3); margin: 0; font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px;">Desempeño en Combate</h3>
      </div>
      <div class="stats-section-content" style="padding: var(--spacing-md);">
        <div class="stats-kda-container" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-md);">
          <div class="stats-kda-card" style="background: rgba(19, 11, 55, 0.5); padding: var(--spacing-md); border-radius: var(--border-radius-md); text-align: center; display: flex; flex-direction: column; gap: var(--spacing-xs); transition: transform 0.2s ease; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <div id="stats-kills" class="stats-kda-value" style="font-size: var(--font-size-xxl); font-weight: var(--font-weight-bold); color: var(--positive-color, #4caf50); text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);">0</div>
            <div class="stats-kda-label" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.5px;">Eliminaciones</div>
        </div>
          <div class="stats-kda-card" style="background: rgba(19, 11, 55, 0.5); padding: var(--spacing-md); border-radius: var(--border-radius-md); text-align: center; display: flex; flex-direction: column; gap: var(--spacing-xs); transition: transform 0.2s ease; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <div id="stats-deaths" class="stats-kda-value" style="font-size: var(--font-size-xxl); font-weight: var(--font-weight-bold); color: var(--negative-color, #f44336); text-shadow: 0 0 8px rgba(244, 67, 54, 0.5);">0</div>
            <div class="stats-kda-label" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.5px;">Muertes</div>
      </div>
          <div class="stats-kda-card" style="background: rgba(19, 11, 55, 0.5); padding: var(--spacing-md); border-radius: var(--border-radius-md); text-align: center; display: flex; flex-direction: column; gap: var(--spacing-xs); transition: transform 0.2s ease; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <div id="stats-assists" class="stats-kda-value" style="font-size: var(--font-size-xxl); font-weight: var(--font-weight-bold); color: var(--info-color, #29b6f6); text-shadow: 0 0 8px rgba(41, 182, 246, 0.5);">0</div>
            <div class="stats-kda-label" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.5px;">Asistencias</div>
        </div>
          <div class="stats-kda-card" style="background: rgba(19, 11, 55, 0.5); padding: var(--spacing-md); border-radius: var(--border-radius-md); text-align: center; display: flex; flex-direction: column; gap: var(--spacing-xs); transition: transform 0.2s ease; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <div id="stats-kda-ratio" class="stats-kda-value" style="font-size: var(--font-size-xxl); font-weight: var(--font-weight-bold); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 8px rgba(188, 118, 255, 0.5);">0.0</div>
            <div class="stats-kda-label" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.5px;">Ratio KDA</div>
      </div>
        </div>
      </div>
    </div>
    
    <!-- Sección de Recursos -->
    <div class="stats-section" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.15); margin-top: var(--spacing-md);">
      <div class="stats-section-header" style="padding: var(--spacing-sm) var(--spacing-md); border-bottom: 1px solid rgba(109, 61, 255, 0.15); background: rgba(109, 61, 255, 0.1);">
        <h3 style="font-size: var(--font-size-md); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.3); margin: 0; font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px;">Recursos y Economía</h3>
      </div>
      <div class="stats-section-content" style="padding: var(--spacing-md);">
        <div class="stats-metrics-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md);">
          
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(255, 193, 7, 0.8);">
            <div class="stats-metric-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 193, 7, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);">
              <img src="../../img/gold-icon.svg" alt="Oro" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(255, 193, 7, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Oro Total</div>
              <div id="stats-gold" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #FFC107; text-shadow: 0 0 8px rgba(255, 193, 7, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(76, 175, 80, 0.8);">
            <div class="stats-metric-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);">
              <img src="../../img/cs-icon.svg" alt="CS" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(76, 175, 80, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">CS Total</div>
              <div id="stats-cs" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #4CAF50; text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(76, 175, 80, 0.8);">
            <div class="stats-metric-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);">
              <img src="../../img/cs-per-min-icon.svg" alt="CS por minuto" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(76, 175, 80, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">CS por Minuto</div>
              <div id="stats-cs-per-min" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #4CAF50; text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);">0.0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(109, 61, 255, 0.8);">
            <div class="stats-metric-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(109, 61, 255, 0.2), rgba(109, 61, 255, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(109, 61, 255, 0.3);">
              <img src="../../img/ward-icon.svg" alt="Wards" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(109, 61, 255, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Wards Colocados</div>
              <div id="stats-wards-placed" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 8px rgba(188, 118, 255, 0.5);">0</div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
    
    <!-- Sección de Daño -->
    <div class="stats-section" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.15); margin-top: var(--spacing-md);">
      <div class="stats-section-header" style="padding: var(--spacing-sm) var(--spacing-md); border-bottom: 1px solid rgba(109, 61, 255, 0.15); background: rgba(109, 61, 255, 0.1);">
        <h3 style="font-size: var(--font-size-md); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.3); margin: 0; font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px;">Análisis de Daño</h3>
      </div>
      <div class="stats-section-content" style="padding: var(--spacing-md);">
        <div class="stats-metrics-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md);">
          
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(233, 30, 99, 0.8);">
            <div class="stats-metric-icon damage-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(233, 30, 99, 0.2), rgba(233, 30, 99, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(233, 30, 99, 0.3);">
              <img src="../../img/damage-icon.svg" alt="Daño" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(233, 30, 99, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Daño Total</div>
              <div id="stats-total-damage" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #E91E63; text-shadow: 0 0 8px rgba(233, 30, 99, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(244, 67, 54, 0.8);">
            <div class="stats-metric-icon damage-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(244, 67, 54, 0.2), rgba(244, 67, 54, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(244, 67, 54, 0.3);">
              <img src="../../img/champion-damage-icon.svg" alt="Daño a campeones" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(244, 67, 54, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Daño a Campeones</div>
              <div id="stats-champion-damage" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #F44336; text-shadow: 0 0 8px rgba(244, 67, 54, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(76, 175, 80, 0.8);">
            <div class="stats-metric-icon heal-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);">
              <img src="../../img/healing-icon.svg" alt="Curación" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(76, 175, 80, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Curación Total</div>
              <div id="stats-total-healing" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #4CAF50; text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);">0</div>
            </div>
          </div>
        
          <div class="stats-metric" style="background: rgba(19, 11, 55, 0.4); border-radius: var(--border-radius-md); padding: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm); transition: transform 0.2s ease; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(255, 152, 0, 0.8);">
            <div class="stats-metric-icon damage-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(255, 152, 0, 0.2), rgba(255, 152, 0, 0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 10px rgba(255, 152, 0, 0.3);">
              <img src="../../img/damage-taken-icon.svg" alt="Daño recibido" style="width: 24px; height: 24px; filter: drop-shadow(0 0 3px rgba(255, 152, 0, 0.5));"/>
            </div>
            <div class="stats-metric-info" style="flex-grow: 1;">
              <div class="stats-metric-name" style="color: var(--text-secondary, rgba(255,255,255,0.65)); font-size: var(--font-size-sm); margin-bottom: 2px;">Daño Recibido</div>
              <div id="stats-damage-taken" class="stats-metric-value" style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: #FF9800; text-shadow: 0 0 8px rgba(255, 152, 0, 0.5);">0</div>
            </div>
          </div>
            
        </div>
      </div>
    </div>
    
    <!-- NUEVA SECCIÓN: TABLA DE VARIABLES -->
    <div class="stats-section" style="background: linear-gradient(180deg, rgba(39, 22, 100, 0.8), rgba(19, 11, 55, 0.8)); border-radius: var(--border-radius-md); overflow: hidden; box-shadow: var(--shadow-md); border: 1px solid rgba(109, 61, 255, 0.15); margin-top: var(--spacing-md);">
      <div class="stats-section-header" style="padding: var(--spacing-sm) var(--spacing-md); border-bottom: 1px solid rgba(109, 61, 255, 0.15); background: rgba(109, 61, 255, 0.1); display: flex; justify-content: space-between; align-items: center;">
        <h3 style="font-size: var(--font-size-md); color: var(--omashu-purple-light, #bc76ff); text-shadow: 0 0 5px rgba(188, 118, 255, 0.3); margin: 0; font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px;">Variables del Juego</h3>
        <div style="display: flex; gap: 10px;">
          <button id="btn-exportar-vars" style="background: linear-gradient(135deg, #2e7d32, #43a047); color: white; border: none; padding: 6px 12px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: var(--font-weight-bold); font-size: var(--font-size-sm); display: flex; align-items: center; gap: 5px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Exportar JSON
          </button>
        </div>
      </div>
      <div class="stats-section-content" style="padding: var(--spacing-md);">
        <div class="variables-wrapper" style="max-height: 400px; overflow-y: auto; background: rgba(13, 7, 35, 0.6); border-radius: var(--border-radius-md); border: 1px solid rgba(109, 61, 255, 0.1); box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);">
          <table id="tabla-variables" style="width: 100%; border-collapse: collapse; font-size: var(--font-size-sm);">
            <thead>
              <tr style="background: linear-gradient(90deg, rgba(39, 22, 100, 0.9), rgba(39, 22, 100, 0.7)); position: sticky; top: 0; z-index: 1; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                <th style="padding: 10px 12px; text-align: left; color: var(--omashu-purple-light, #bc76ff); font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid rgba(109, 61, 255, 0.3);">Variable</th>
                <th style="padding: 10px 12px; text-align: left; color: var(--omashu-purple-light, #bc76ff); font-weight: var(--font-weight-bold); text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid rgba(109, 61, 255, 0.3);">Valor</th>
              </tr>
            </thead>
            <tbody id="variables-body" style="color: var(--text-primary, #fff);">
              <!-- Aquí se insertarán dinámicamente las variables -->
              <tr>
                <td colspan="2" style="text-align: center; padding: 30px; font-size: var(--font-size-md); color: var(--text-secondary, rgba(255,255,255,0.65));">
                  <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.6;">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="8" x2="12" y2="12"></line>
                      <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    Cargando variables...
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- CONTENEDOR ADICIONAL PARA DEBUG DE VARIABLES EN TEXTO PLANO -->
    <div id="plain-text-variables-debug" style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: rgba(0,0,0,0.4); border-radius: var(--border-radius-md); border: 1px dashed #888; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 11px; color: #ccc; line-height: 1.4;">
      <h4 style="margin: 0 0 10px 0; color: #FF9800; border-bottom: 1px solid #555; padding-bottom: 5px;">DEBUG: Rutas de Variables (Texto Plano)</h4>
      <!-- Las rutas se insertarán aquí -->
    </div>

  </div>
</div>

<script>
(function() { // Inicio de IIFE
  // Todo el código JS existente de la pestaña va aquí dentro

  // Función para formatear el tiempo de juego - misma que en tab-overview.html
  function formatGameTime(seconds) {
    if (!seconds && seconds !== 0) return "00:00";
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }

  // Función para formatear números grandes con separadores de mil
  function formatNumber(num) {
    return new Intl.NumberFormat('es-ES').format(num);
  }

  // Función para calcular el ratio KDA
  function calculateKDARatio(kills, deaths, assists) {
    if (deaths === 0) return ((kills + assists) > 0 ? "Perfect" : "0.0");
    return ((kills + assists) / deaths).toFixed(1);
  }
  
  // Variables para seguimiento de datos
  let ultimosDatos = {};
  // let variablesFiltradas = false; // Ya no es necesario si no filtramos
  
  // Función para actualizar la tabla de variables (ahora local a la IIFE)
  function actualizarTablaVariables(gameData) {
    // DEBUG: Loguear inicio de la función de tabla
    console.log("[TABLA | actualizarTablaVariables] Iniciando con datos:", gameData ? 'Datos presentes' : 'Datos ausentes');
    
    // Referencia al contenedor de texto plano para debug
    const plainTextOutput = document.getElementById('plain-text-variables-debug');
    if (plainTextOutput) {
      // Limpiar solo el contenido, no el título
      const titleElement = plainTextOutput.querySelector('h4');
      plainTextOutput.innerHTML = ''; 
      if (titleElement) plainTextOutput.appendChild(titleElement);
    }

    try {
      // Guardar los datos para exportación
      ultimosDatos = JSON.parse(JSON.stringify(gameData || {}));
      
      // Obtener el cuerpo de la tabla
      const tbody = document.getElementById('variables-body');
      if (!tbody) {
        console.error("[TABLA] No se encontró el elemento #variables-body");
        return;
      }
      
      // Limpiar contenido existente de la tabla
      tbody.innerHTML = '';
      
      // Si no hay datos, mostrar mensaje en tabla y debug
      if (!gameData || Object.keys(gameData).length === 0) {
        const noDataHtml = `
          <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M8 15h8M9.5 9h.01M14.5 9h.01"></path>
            </svg>
            <div style="font-size: var(--font-size-md); color: var(--text-secondary); font-weight: var(--font-weight-medium);">
              No hay datos disponibles del juego
            </div>
          </div>
        `;
        // Mensaje en tabla
        const fila = document.createElement('tr');
        const celda = document.createElement('td');
        celda.colSpan = 2;
        celda.style.textAlign = 'center';
        celda.style.padding = '30px';
        celda.innerHTML = noDataHtml;
        fila.appendChild(celda);
        tbody.appendChild(fila);
        // Mensaje en debug
        if(plainTextOutput) plainTextOutput.innerHTML += '<p style="color:#888;">No hay datos disponibles del juego.</p>';
        console.error("[TABLA] No hay datos disponibles para mostrar");
        return;
      }
      
      // Variables destacadas (se mantienen para estilo)
      const variablesDestacadas = [
        'summoner.name', 'summoner.position', 'match.gameTime', 
        'match.kills', 'match.deaths', 'match.assists', 
        'match.cs', 'gold', 'match.gold', 'vision.wardsPlaced'
      ];
      
      let filasProcesadas = 0;
      const maxFilas = 500; // Límite para evitar sobrecarga

      // Función recursiva para procesar todas las propiedades anidadas
      function procesarObjeto(obj, prefijo = '') {
        // DEBUG: Loguear entrada a procesarObjeto (DESCOMENTADO)
        console.log(`[TABLA | procesarObjeto] Procesando prefijo: '${prefijo}', tipo: ${typeof obj}`);

        if (!obj || typeof obj !== 'object' || filasProcesadas >= maxFilas) {
          return;
        }
        
        // Ordenar las claves alfabéticamente
        const claves = Object.keys(obj).sort();
        
        for (const clave of claves) {
          if (filasProcesadas >= maxFilas) break;
          
          const valor = obj[clave];
          const nombreCompleto = prefijo ? `${prefijo}.${clave}` : clave;
          
          // DEBUG: Loguear cada clave/valor que se procesa (DESCOMENTADO)
          console.log(`[TABLA | procesarObjeto]   - Clave: '${clave}', Ruta: '${nombreCompleto}', Tipo Valor: ${typeof valor}`);

          // --- Añadir ruta a texto plano para DEBUG ---
          if (plainTextOutput) {
             const p = document.createElement('p');
             p.style.margin = '2px 0';
             p.textContent = nombreCompleto;
             plainTextOutput.appendChild(p);
          }
          // ---------------------------------------------

          // Verificar si es una variable destacada (solo para estilo)
          const esDestacada = variablesDestacadas.includes(nombreCompleto);
          
          // Crear fila para esta propiedad
          const fila = document.createElement('tr');
          fila.style.borderBottom = '1px solid rgba(109, 61, 255, 0.1)';
          
          if (esDestacada) {
            fila.style.background = 'rgba(109, 61, 255, 0.08)';
          }
          
          // --- Celda para el nombre de la variable (RUTA COMPLETA) ---
          const celdaNombre = document.createElement('td');
          celdaNombre.style.padding = '8px 12px';
          celdaNombre.style.wordBreak = 'break-all'; // Para rutas largas
          
          // Agregar icono (basado en la parte inicial de la ruta)
          let iconoHTML = '';
          const rutaInicial = nombreCompleto.split('.')[0];
          if (rutaInicial === 'summoner') iconoHTML = '👤';
          else if (rutaInicial === 'match') iconoHTML = '🎮';
          else if (rutaInicial === 'vision' || rutaInicial === 'ward') iconoHTML = '👁️';
          else if (rutaInicial === 'combat' || rutaInicial === 'damage' || rutaInicial === 'heal') iconoHTML = '⚔️';
          else if (rutaInicial === 'gold' || rutaInicial === 'cs') iconoHTML = '💰';
          else if (rutaInicial === 'live_client_data') iconoHTML = '⚡'; // Icono para Live Client Data
          else if (rutaInicial === 'events') iconoHTML = '🔔'; // Icono para events array
          else if (rutaInicial === 'objectives') iconoHTML = '🏰'; // Icono para objectives
          
          celdaNombre.innerHTML = `
            <span style="opacity:0.7; margin-right:6px;">${iconoHTML}</span>
            <span style="${esDestacada ? 'color:#bc76ff; font-weight:bold;' : ''}">${nombreCompleto}</span>
          `;
          
          // --- Celda para el valor --- 
          const celdaValor = document.createElement('td');
          celdaValor.style.padding = '8px 12px';
          
          // Formatear el valor según su tipo
          if (valor === null) {
            celdaValor.innerHTML = '<span style="color:#888; font-style:italic;">null</span>';
          } else if (valor === undefined) {
            celdaValor.innerHTML = '<span style="color:#888; font-style:italic;">undefined</span>';
          } else if (typeof valor === 'object') {
            if (Array.isArray(valor)) {
              // Formato para arrays
              celdaValor.innerHTML = `<span class="valor-tag valor-array">
                <svg width="14" height="14" viewBox="0 0 24 24"><path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/></svg>
                Array[${valor.length}]
              </span>`;
              // DEBUG: Loguear antes de la llamada recursiva para Array (DESCOMENTADO)
              console.log(`[TABLA | procesarObjeto]     Recursión para Array: ${nombreCompleto}`);
              // Llamada recursiva para los elementos del array (si no es muy grande)
              if (valor.length < 20) { // Limitar recursión en arrays grandes
                 // DEBUG: Log ANTES de recursión Array
                 console.log(`[TABLA | recursión] ===> Llamando procesarObjeto para Array: ${nombreCompleto}`);
                 try {
                   procesarObjeto(valor, nombreCompleto);
                   // DEBUG: Log DESPUÉS de recursión Array (éxito)
                   console.log(`[TABLA | recursión] <=== Retorno procesarObjeto para Array: ${nombreCompleto}`);
                 } catch (e) {
                   // DEBUG: Log DESPUÉS de recursión Array (ERROR)
                   console.error(`[TABLA | recursión] <=== ERROR en procesarObjeto para Array: ${nombreCompleto}`, e);
                 }
              }
            } else {
              // Formato para objetos
              celdaValor.innerHTML = `<span class="valor-tag valor-object">
                 <svg width="14" height="14" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                 Object{${Object.keys(valor).length} props}
              </span>`;
              // DEBUG: Loguear antes de la llamada recursiva para Object (DESCOMENTADO)
              // console.log(`[TABLA | procesarObjeto]     Recursión para Object: ${nombreCompleto}`);
              
              // Llamada recursiva para las propiedades del objeto
              // DEBUG: Log ANTES de recursión Object
              console.log(`[TABLA | recursión] ===> Llamando procesarObjeto para Object: ${nombreCompleto}`);
              const clavesInternas = Object.keys(valor);
              console.log(`[TABLA | recursión]       Claves internas para ${nombreCompleto}: ${clavesInternas.join(', ')}`);
              try {
                procesarObjeto(valor, nombreCompleto);
                // DEBUG: Log DESPUÉS de recursión Object (éxito)
                console.log(`[TABLA | recursión] <=== Retorno procesarObjeto para Object: ${nombreCompleto}`);
              } catch (e) {
                // DEBUG: Log DESPUÉS de recursión Object (ERROR)
                console.error(`[TABLA | recursión] <=== ERROR en procesarObjeto para Object: ${nombreCompleto}`, e);
              }
            }
          } else {
            // Para valores simples
            if (typeof valor === 'boolean') {
              const colorBool = valor ? '#4CAF50' : '#F44336';
              const bgColorBool = valor ? 'rgba(76, 175, 80, 0.1)' : 'rgba(244, 67, 54, 0.1)';
              const borderColorBool = valor ? 'rgba(76, 175, 80, 0.2)' : 'rgba(244, 67, 54, 0.2)';
              const iconBool = valor ? 
                '<path d="M20 6L9 17l-5-5"></path>' : 
                '<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>';
                
              celdaValor.innerHTML = `<span class="valor-tag valor-boolean" style="background:${bgColorBool}; color:${colorBool}; border-color:${borderColorBool};">
                <svg width="14" height="14" viewBox="0 0 24 24">${iconBool}</svg>
                ${valor.toString()}
              </span>`;
            } else if (typeof valor === 'number') {
              // Formato para números
              celdaValor.innerHTML = `<span class="valor-tag valor-number" ${esDestacada ? 'style="font-weight:bold;"' : ''}>${valor.toString()}</span>`;
            } else {
              // Formato para strings y otros
              celdaValor.innerHTML = `<span class="valor-tag valor-string" ${esDestacada ? 'style="color:#bc76ff; font-weight:bold;"' : ''}>${valor.toString()}</span>`;
            }
          }
          
          // Añadir celdas a la fila
          fila.appendChild(celdaNombre);
          fila.appendChild(celdaValor);
          
          // Añadir fila a la tabla
          tbody.appendChild(fila);
          filasProcesadas++; // Incrementar contador aquí
        } // Fin del bucle for
      } // Fin de procesarObjeto
      
      // Iniciar procesamiento
      procesarObjeto(gameData);
      console.log(`[TABLA | actualizarTablaVariables] Finalizado. Total filas tabla: ${tbody.childElementCount}, Filas procesadas: ${filasProcesadas}`); // Modificado log final
      
      // Añadir mensaje de límite si se alcanzó (tanto en tabla como en debug)
      if (filasProcesadas >= maxFilas) {
         const limitMsg = `Mostrando ${maxFilas} variables para mejorar rendimiento...`;
         // Mensaje en tabla
         const filaFinal = document.createElement('tr');
         const celdaFinal = document.createElement('td');
         celdaFinal.colSpan = 2;
         celdaFinal.style.textAlign = 'center';
         celdaFinal.style.padding = '10px';
         celdaFinal.style.color = '#FF9800';
         celdaFinal.style.fontStyle = 'italic';
         celdaFinal.textContent = limitMsg;
         filaFinal.appendChild(celdaFinal);
         tbody.appendChild(filaFinal);
         // Mensaje en debug
         if(plainTextOutput) plainTextOutput.innerHTML += `<p style="color:#FF9800; font-style:italic;">${limitMsg}</p>`;
      }
      
      // Mostrar mensaje si no hay variables después de procesar (tanto en tabla como en debug)
      if (tbody.childElementCount === 0) { // Revisa si la tabla está vacía
        const noVarsHtml = `
          <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
             <svg width="40" height="40" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 15h8M9.5 9h.01M14.5 9h.01"/></svg>
             <div style="font-size: var(--font-size-md); color: var(--text-secondary); font-weight: var(--font-weight-medium);">No se encontraron variables para mostrar</div>
           </div>`;
        // Mensaje en tabla
        const fila = document.createElement('tr');
        const celda = document.createElement('td');
        celda.colSpan = 2;
        celda.style.textAlign = 'center';
        celda.style.padding = '30px';
        celda.innerHTML = noVarsHtml;
        fila.appendChild(celda);
        tbody.appendChild(fila);
        // Mensaje en debug
        if(plainTextOutput) plainTextOutput.innerHTML += '<p style="color:#888;">No se encontraron variables para mostrar.</p>';
      }
    } catch (error) {
      // ... (manejo de error existente)
      console.error("[TABLA] Error al procesar la tabla de variables:", error);
      // DEBUG: Loguear el error
      console.log("[TABLA | actualizarTablaVariables] Error procesando tabla: ", error);
      const tbody = document.getElementById('variables-body');
      if (tbody) {
        tbody.innerHTML = ''; // Limpiar antes de mostrar error
        const fila = document.createElement('tr');
        const celda = document.createElement('td');
        celda.colSpan = 2;
        celda.style.textAlign = 'center';
        celda.style.padding = '30px';
        celda.innerHTML = `
          <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#F44336" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
            <div style="font-size: var(--font-size-md); color: #F44336; font-weight: var(--font-weight-medium);">Error: ${error.message}</div>
          </div>`;
        fila.appendChild(celda);
        tbody.appendChild(fila);
        // Mensaje en debug
        if(plainTextOutput) plainTextOutput.innerHTML += `<p style="color:#F44336;">Error procesando variables: ${error.message}</p>`;
      }
    }
  }

  // ========== FUNCIÓN PRINCIPAL DE ACTUALIZACIÓN DE UI ========== (ahora local a la IIFE)
  function updateUI(gameData) {
    // DEBUG: Loguear los datos completos recibidos
    console.log("[tab-stats | updateUI] Datos recibidos:", gameData ? JSON.stringify(gameData).substring(0, 300) + '...' : 'null/undefined');
    console.log("[tab-stats | updateUI] Tipos de claves principales:", gameData ? Object.keys(gameData).map(k => `${k}: ${typeof gameData[k]}`) : 'N/A');

    console.log("[tab-stats] Actualizando con datos:", {
      summoner: gameData.summoner ? gameData.summoner.name : "no disponible",
      gameTime: gameData.match ? gameData.match.gameTime : "no disponible",
      kda: gameData.match ? `${gameData.match.kills}/${gameData.match.deaths}/${gameData.match.assists}` : "no disponible"
    });
    
    // Datos crudos para depuración
    console.log("[tab-stats] Estructura de datos completa:", JSON.stringify(gameData).substring(0, 500) + "...");
    
    // IMPORTANTE: Actualizar primero las variables principales
    
    // Información del jugador
    if (gameData.summoner) {
      document.getElementById('stats-player-name').textContent = gameData.summoner.name || "Invocador";
    }
    
    // Tipo de partida y tiempo
    if (gameData.match) {
      if (gameData.match.gameMode) {
        document.getElementById('stats-match-type').textContent = gameData.match.gameMode;
      }
      
      if (gameData.match.gameTime !== undefined) {
        document.getElementById('stats-game-time').textContent = formatGameTime(gameData.match.gameTime);
      }
      
      // KDA - MISMO PATRÓN QUE TAB-OVERVIEW
      document.getElementById('stats-kills').textContent = gameData.match.kills || 0;
      document.getElementById('stats-deaths').textContent = gameData.match.deaths || 0;
      document.getElementById('stats-assists').textContent = gameData.match.assists || 0;
      
      // Ratio KDA
      const kills = parseInt(gameData.match.kills) || 0;
      const deaths = parseInt(gameData.match.deaths) || 0;
      const assists = parseInt(gameData.match.assists) || 0;
      document.getElementById('stats-kda-ratio').textContent = calculateKDARatio(kills, deaths, assists);
      
      // CS y CS por minuto
      if (gameData.match.cs !== undefined) {
        document.getElementById('stats-cs').textContent = gameData.match.cs;
        
        if (gameData.match.gameTime !== undefined && gameData.match.gameTime > 0) {
          const gameTimeInMinutes = Math.max(gameData.match.gameTime / 60, 1);
          const csPerMinute = (gameData.match.cs / gameTimeInMinutes).toFixed(1);
          document.getElementById('stats-cs-per-min').textContent = csPerMinute;
        }
      }
      
      // Oro - Verificar múltiples ubicaciones posibles
      if (gameData.match.gold !== undefined) {
        document.getElementById('stats-gold').textContent = formatNumber(gameData.match.gold);
      } else if (gameData.gold !== undefined) {
        console.log("Encontrado oro en gameData.gold en lugar de gameData.match.gold");
        document.getElementById('stats-gold').textContent = formatNumber(gameData.gold);
      }
    }
    
    // Wards desde múltiples fuentes posibles
    let wardsPlaced = 0;
    if (gameData.ward && gameData.ward.placed !== undefined) {
      wardsPlaced = parseInt(gameData.ward.placed) || 0;
    } else if (gameData.vision && gameData.vision.wardsPlaced !== undefined) {
      wardsPlaced = gameData.vision.wardsPlaced;
    } else if (gameData.objectives && gameData.objectives.wardPlaced !== undefined) {
      wardsPlaced = gameData.objectives.wardPlaced;
    }
    document.getElementById('stats-wards-placed').textContent = wardsPlaced;
    
    // Daño desde diferentes fuentes
    if (gameData.combat) {
      if (gameData.combat.damageDealt !== undefined) {
        document.getElementById('stats-total-damage').textContent = formatNumber(gameData.combat.damageDealt);
      }
      
      if (gameData.combat.totalDamageToChampions !== undefined) {
        document.getElementById('stats-champion-damage').textContent = formatNumber(gameData.combat.totalDamageToChampions);
      } else if (gameData.combat.damageDealtToChampions !== undefined) {
        document.getElementById('stats-champion-damage').textContent = formatNumber(gameData.combat.damageDealtToChampions);
      }
      
      if (gameData.combat.damageTaken !== undefined) {
        document.getElementById('stats-damage-taken').textContent = formatNumber(gameData.combat.damageTaken);
      }
      
      if (gameData.combat.healing !== undefined) {
        document.getElementById('stats-total-healing').textContent = formatNumber(gameData.combat.healing);
      } else if (gameData.combat.healingDone !== undefined) {
        document.getElementById('stats-total-healing').textContent = formatNumber(gameData.combat.healingDone);
      }
    }
    
    // IMPORTANTE: Actualizar tabla de variables DESPUÉS de updateUI principal
    // para que no interfiera con la actualización principal
    setTimeout(function() {
      try {
        // DEBUG: Confirmar llamada y datos pasados
        console.log("[tab-stats | updateUI -> setTimeout] Llamando a actualizarTablaVariables con datos del juego:", gameData ? 'Datos presentes' : 'Datos ausentes');
        actualizarTablaVariables(gameData);
      } catch (e) {
        console.error("Error al actualizar tabla de variables:", e);
        // Esto no debe detener la actualización principal
      }
    }, 10);
  }
  
  // Función para exportar datos a JSON (ahora local a la IIFE)
  function exportarVariablesJSON() {
    // Referencia al botón para mostrar estados
    const btnExportar = document.getElementById('btn-exportar-vars');
    
    if (!ultimosDatos || Object.keys(ultimosDatos).length === 0) {
      // Mostrar mensaje de error visual en el botón
      const btnTextoOriginal = btnExportar.innerHTML;
      btnExportar.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        Sin datos
      `;
      btnExportar.style.background = 'linear-gradient(135deg, #d32f2f, #f44336)';
      
      setTimeout(() => {
        btnExportar.innerHTML = btnTextoOriginal;
        btnExportar.style.background = 'linear-gradient(135deg, #2e7d32, #43a047)';
      }, 2000);
      
      return;
    }
    
    try {
      // Cambiar aspecto del botón para mostrar estado de carga
      const btnTextoOriginal = btnExportar.innerHTML;
      btnExportar.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite;">
          <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
        </svg>
        Exportando...
      `;
      btnExportar.disabled = true;
      btnExportar.style.opacity = '0.8';
      
      const jsonStr = JSON.stringify(ultimosDatos, null, 2);
      
      // Usar la API de Overwolf para guardar el archivo
      const timestamp = new Date().toISOString().replace(/:/g, '-').replace(/\..+/, '');
      const fileName = `lol-variables-${timestamp}.json`;
      const overwolfFileName = `${overwolf.io.paths.documents}\\Overwolf\\${fileName}`;
      
      // Método específico de Overwolf para escribir archivos
      overwolf.io.writeFileContents(
        overwolfFileName, 
        jsonStr, 
        "UTF8", 
        true, 
        (result) => {
          if (result.success) {
            // Mostrar notificación de éxito
            overwolf.notifications.showToast({
              header: "Variables exportadas",
              message: `Guardado en: ${overwolfFileName}`,
              duration: 5
            });
            
            // Actualizar botón con confirmación visual
            btnExportar.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 6L9 17l-5-5"></path>
              </svg>
              Exportado
            `;
            btnExportar.style.background = 'linear-gradient(135deg, #388e3c, #4caf50)';
            
            // Restaurar botón después de un tiempo
            setTimeout(() => {
              btnExportar.innerHTML = btnTextoOriginal;
              btnExportar.disabled = false;
              btnExportar.style.opacity = '1';
              btnExportar.style.background = 'linear-gradient(135deg, #2e7d32, #43a047)';
            }, 2000);
            
            console.log(`Variables guardadas con éxito en: ${overwolfFileName}`);
          } else {
            console.error("Error al exportar variables:", result.error);
            
            // Mostrar error visualmente en el botón
            btnExportar.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              Error
            `;
            btnExportar.style.background = 'linear-gradient(135deg, #d32f2f, #f44336)';
            
            // Mostrar alerta con el error completo
            alert(`Error al exportar variables: ${result.error}`);
            
            // Restaurar botón después de un tiempo
            setTimeout(() => {
              btnExportar.innerHTML = btnTextoOriginal;
              btnExportar.disabled = false;
              btnExportar.style.opacity = '1';
              btnExportar.style.background = 'linear-gradient(135deg, #2e7d32, #43a047)';
            }, 2000);
          }
        }
      );
    } catch (e) {
      console.error("Error exportando datos:", e);
      
      // Mostrar error visualmente
      btnExportar.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        Error
      `;
      btnExportar.style.background = 'linear-gradient(135deg, #d32f2f, #f44336)';
      
      // Mostrar alerta con el error
      alert("Error al exportar datos: " + e.message);
      
      // Restaurar botón después de un tiempo
      setTimeout(() => {
        const btnTextoOriginal = `
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Exportar JSON
        `;
        btnExportar.innerHTML = btnTextoOriginal;
        btnExportar.disabled = false;
        btnExportar.style.opacity = '1';
        btnExportar.style.background = 'linear-gradient(135deg, #2e7d32, #43a047)';
      }, 2000);
    }
  }

  // Inicialización
  document.addEventListener('DOMContentLoaded', function() {
    console.log("[stats-IIFE] Tab-stats cargado, iniciando...");
    
    try {
      // Adjuntar eventos a los botones
      const btnExportar = document.getElementById('btn-exportar-vars');
      if (btnExportar) {
        btnExportar.addEventListener('click', exportarVariablesJSON);
      }
      
      // Encontrar el elemento de la pestaña ACTUAL
      const thisScriptElement = document.currentScript;
      const tabElement = thisScriptElement ? thisScriptElement.closest('.stats-container') : document.getElementById('stats-tab'); // Ajustar selector si es necesario
      
      if (!tabElement) {
         console.error("[stats-IIFE] No se pudo encontrar el elemento raíz de la pestaña.");
         // Intentar buscar por ID como fallback
         const fallbackTabElement = document.getElementById('stats-tab');
         if(fallbackTabElement) {
             console.warn("[stats-IIFE] Usando fallback getElementById('stats-tab')");
             fallbackTabElement.updateUIFunction = updateUI;
             // Exponer la función actualizarTablaVariables para acceso directo (si se necesita)
             fallbackTabElement.actualizarTablaVariables = actualizarTablaVariables;
         } else {
             return; // Salir si no se encuentra el elemento
         }
      } else {
          // Adjuntar la función updateUI LOCAL al elemento de la pestaña
          tabElement.updateUIFunction = updateUI;
          // Exponer la función actualizarTablaVariables para acceso directo (si se necesita)
          tabElement.actualizarTablaVariables = actualizarTablaVariables;
          console.log("[stats-IIFE] updateUI y actualizarTablaVariables adjuntadas al elemento de la pestaña.");
      }
      
      // Registrar globalmente (opcional, preferiblemente evitar)
      // if (!window.tabUpdateFunctions) window.tabUpdateFunctions = {};
      // window.tabUpdateFunctions['stats-tab'] = updateUI;
      
      // SUBSCRIPCIONES
      function subscribeToData() {
          // ... (código de suscripción existente, igual que en overview)
          if (window.gameDataManager && typeof window.gameDataManager.subscribe === 'function') {
            console.log("[stats-IIFE] Suscribiendo via window.gameDataManager");
            window.gameDataManager.subscribe(updateUI);
          } else {
            overwolf.windows.getMainWindow(mainWindow => {
              if (mainWindow && mainWindow.gameDataManager && typeof mainWindow.gameDataManager.subscribe === 'function') {
                console.log("[stats-IIFE] Suscribiendo via mainWindow.gameDataManager");
                mainWindow.gameDataManager.subscribe(updateUI);
              } else {
                console.error("[stats-IIFE] No se pudo encontrar gameDataManager para suscribir.");
              }
            });
          }
      }
      subscribeToData();
      
      // FORZAR ACTUALIZACIÓN INICIAL SI ES NECESARIO
      // (El código existente para forzar ya no debería ser necesario si la suscripción funciona)
      // console.log("Llamando a forceUpdateActiveTab para actualizar inmediatamente");
      // if (window.forceUpdateActiveTab) { window.forceUpdateActiveTab(); }
      
      // Datos iniciales de test (solo si la suscripción tarda)
      console.log("[stats-IIFE] Llamando a updateUI directamente con datos de prueba iniciales");
      updateUI({
        summoner: { name: "Cargando...", position: "-" },
        match: { gameMode: "-", gameTime: 0, kills: 0, deaths: 0, assists: 0, cs: 0, gold: 0 },
        vision: { wardsPlaced: 0 },
        combat: { damageDealt: 0, damageDealtToChampions: 0, damageTaken: 0, healing: 0 }
      });
      
    } catch (e) {
      console.error('[stats-IIFE] Error al inicializar:', e);
    }
  });
  
  // Ya no necesitamos la referencia global window._statsUpdateUI
  // window._statsUpdateUI = updateUI;

})(); // Fin de IIFE
</script>

<!-- Estilos movidos fuera y después del script -->
<style>
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
  }
  
  .stats-kda-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  }
  /* Estilos para filas de la tabla de variables */
  #tabla-variables tbody tr {
    border-bottom: 1px solid rgba(109, 61, 255, 0.1);
    transition: background-color 0.2s ease;
  }
  
  #tabla-variables tbody tr:hover {
    background-color: rgba(109, 61, 255, 0.1);
  }
  
  /* Estilos para el botón de exportar */
  #btn-exportar-vars:hover {
    background: linear-gradient(135deg, #43a047, #66bb6a);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
  }
  
  #btn-exportar-vars:active {
    transform: translateY(0px);
  }
  
  /* Estilos para la barra de desplazamiento */
  .variables-wrapper::-webkit-scrollbar {
    width: 8px;
  }
  
  .variables-wrapper::-webkit-scrollbar-track {
    background: rgba(13, 7, 35, 0.3);
    border-radius: 4px;
  }
  
  .variables-wrapper::-webkit-scrollbar-thumb {
    background: rgba(109, 61, 255, 0.3);
    border-radius: 4px;
  }
  
  .variables-wrapper::-webkit-scrollbar-thumb:hover {
    background: rgba(109, 61, 255, 0.5);
  }
  
  /* Efectos hover para métricas */
  .stats-metric:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  }

  /* Estilos para tags de valor */
  .valor-tag {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 8px;
    border-radius: 4px;
    border: 1px solid transparent;
    font-size: var(--font-size-xs);
  }

  .valor-tag svg {
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
    opacity: 0.8;
  }

  .valor-array {
    background: rgba(95, 158, 160, 0.1);
    color: #5F9EA0;
    border-color: rgba(95, 158, 160, 0.2);
  }

  .valor-object {
    background: rgba(123, 104, 238, 0.1);
    color: #7B68EE;
    border-color: rgba(123, 104, 238, 0.2);
  }

  .valor-boolean {
    /* Estilos ya definidos inline por simplicidad */
  }

  .valor-number {
    background: rgba(3, 169, 244, 0.1);
    color: #03A9F4;
    border-color: rgba(3, 169, 244, 0.2);
  }

  .valor-string {
    background: rgba(255, 255, 255, 0.08);
    color: white;
    border-color: rgba(255, 255, 255, 0.15);
  }
  
  /* ANIMACIONES ADICIONALES */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .stats-metric-value, .stats-kda-value {
    animation: fadeInUp 0.5s ease-out;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .stats-section {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .stats-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
  }

  .stats-header::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
      rgba(109, 61, 255, 0) 0%, 
      rgba(109, 61, 255, 0.05) 50%, 
      rgba(109, 61, 255, 0) 100%);
    animation: shimmer 3s infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
</style> 